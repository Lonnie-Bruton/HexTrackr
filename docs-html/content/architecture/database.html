<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <h1>Database Architecture</h1>
<p>HexTrackr uses a file-based SQLite 3 database as its primary data store. This document provides a high-level overview of the database architecture, focusing on relationships and data flows.</p>
<p><strong>Note</strong>: The definitive and most up-to-date information on the database schema, including table structures and column descriptions, can be found in the <a href="./data-model.html">Data Model documentation</a>.</p>
<h2>Engine</h2>
<ul>
<li><strong>Type</strong>: SQLite 3</li>
<li><strong>Location</strong>: <code>data/hextrackr.db</code></li>
<li><strong>Initialization</strong>: The database is initialized by the <code>scripts/init-database.js</code> script.</li>
</ul>
<hr>
<h2>Entity Relationship Diagram</h2>
<p>This diagram illustrates the relationships between the main tables in the database.</p>
<pre><code class="language-mermaid">erDiagram
    vulnerability_imports ||--o{ vulnerability_snapshots : contains
    tickets ||--o{ ticket_vulnerabilities : links
    vulnerabilities_current ||--o{ ticket_vulnerabilities : links

    vulnerability_imports {
        INTEGER id PK
        TEXT filename
        TEXT import_date
        INTEGER row_count
    }

    vulnerability_snapshots {
        INTEGER id PK
        INTEGER import_id FK
        TEXT scan_date
        TEXT hostname
        TEXT cve
        TEXT severity
        REAL vpr_score
        TEXT unique_key
    }

    vulnerabilities_current {
        INTEGER id PK
        TEXT unique_key UK
        TEXT hostname
        TEXT cve
        TEXT severity
        REAL vpr_score
        TEXT last_seen
    }

    tickets {
        TEXT id PK
        TEXT xt_number
        TEXT date_submitted
        TEXT status
    }

    ticket_vulnerabilities {
        INTEGER id PK
        TEXT ticket_id FK
        INTEGER vulnerability_id FK
    }
</code></pre>
<hr>
<h2>Data Flows</h2>
<h3>Vulnerability CSV Import</h3>
<p>This flow shows how a CSV file upload is processed and stored in the database using the rollover architecture.</p>
<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant API as POST /api/vulnerabilities/import
    participant DB as SQLite

    User-&gt;&gt;API: Upload csvFile
    API-&gt;&gt;DB: INSERT into vulnerability_imports
    API-&gt;&gt;DB: INSERT into vulnerability_snapshots
    API-&gt;&gt;DB: INSERT or UPDATE vulnerabilities_current
    API--&gt;&gt;User: { success, importId, ... }
</code></pre>
<h3>Ticket Creation</h3>
<p>This flow shows the simple process of creating a new ticket.</p>
<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant API as POST /api/tickets
    participant DB as SQLite

    User-&gt;&gt;API: { ticketData }
    API-&gt;&gt;DB: INSERT into tickets
    API--&gt;&gt;User: { success, id }
</code></pre>

    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>
