<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧠 rAgent Conversation Memory Engine - rEngine Core Documentation</title>
    <style>
        :root {
            --rengine-primary: #6366f1;
            --rengine-secondary: #8b5cf6;
            --rengine-accent: #06b6d4;
            --rengine-text: #1f2937;
            --rengine-text-light: #6b7280;
            --rengine-bg: #ffffff;
            --rengine-bg-alt: #f8fafc;
            --rengine-border: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--rengine-text);
            background: var(--rengine-bg);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        header {
            background: linear-gradient(135deg, var(--rengine-primary), var(--rengine-secondary));
            color: white;
            padding: 2rem 0;
            margin-bottom: 3rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "⚙️";
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .nav-links a:hover {
            opacity: 1;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--rengine-primary);
        }

        h2 {
            font-size: 2rem;
            font-weight: 600;
            margin: 2rem 0 1rem 0;
            color: var(--rengine-primary);
            border-bottom: 2px solid var(--rengine-border);
            padding-bottom: 0.5rem;
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem 0;
            color: var(--rengine-secondary);
        }

        h4, h5, h6 {
            font-weight: 600;
            margin: 1rem 0 0.5rem 0;
            color: var(--rengine-text);
        }

        p {
            margin-bottom: 1rem;
            color: var(--rengine-text);
        }

        .content {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
        }

        code {
            background: var(--rengine-bg-alt);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: var(--rengine-primary);
        }

        pre {
            background: var(--rengine-bg-alt);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid var(--rengine-primary);
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--rengine-text);
        }

        blockquote {
            border-left: 4px solid var(--rengine-accent);
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: var(--rengine-text-light);
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--rengine-border);
        }

        th {
            background: var(--rengine-bg-alt);
            font-weight: 600;
            color: var(--rengine-primary);
        }

        .metadata {
            background: var(--rengine-bg-alt);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border: 1px solid var(--rengine-border);
        }

        .metadata-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .metadata-label {
            font-weight: 600;
            color: var(--rengine-text-light);
        }

        footer {
            background: var(--rengine-bg-alt);
            padding: 2rem 0;
            margin-top: 3rem;
            text-align: center;
            color: var(--rengine-text-light);
            border-top: 1px solid var(--rengine-border);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .footer-links a {
            color: var(--rengine-primary);
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                gap: 1rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">rEngine Core</div>
                <nav class="nav-links">
                    <a href="../index.html">Home</a>
                    <a href="../README.html">Documentation</a>
                    <a href="https://github.com/lbruton/StackTrackr">GitHub</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="content">
            <h1>🧠 rAgent Conversation Memory Engine</h1>
            
            
            <div class="metadata">
                
                    <div class="metadata-item">
                        <span class="metadata-label">Source File:</span>
                        <span>CONVERSATION-MEMORY-ENGINE.md</span>
                    </div>
                
                    <div class="metadata-item">
                        <span class="metadata-label">Generated:</span>
                        <span>2025-08-20</span>
                    </div>
                
                    <div class="metadata-item">
                        <span class="metadata-label">Last Modified:</span>
                        <span>2025-08-20</span>
                    </div>
                
                    <div class="metadata-item">
                        <span class="metadata-label">Converter:</span>
                        <span>rEngine MCP HTML Converter</span>
                    </div>
                
            </div>
            
            
            [36m🤖 Calling Google Gemini (gemini-1.5-flash)...[0m
[32m✅ Response received in 23559ms[0m

[1m🤖 Google Gemini Response:[0m

```html
<section class="conversation-flow">
  <h2>Conversation Flow</h2>
  <figure class="diagram">
    <pre><code>
┌─────────────────────────────────────────────────────────────┐
│                    CONVERSATION FLOW                        │
├─────────────────────────────────────────────────────────────┤
│  You ←→ Agent (Copilot/Claude)  ←→  rAgent Memory Engine    │
│                                      ↓                      │
│                              Ollama Scribe (gemma2:2b)      │
│                                      ↓                      │
│                              Docker Memory Search           │
│                                      ↓                      │
│                         Persistent Memory Database          │
└─────────────────────────────────────────────────────────────┘
    </code></pre>
    <figcaption>Conversation Flow Diagram</figcaption>
  </figure>
</section>

<section class="code-section">
  <h3>Conversation Scribe (<code>gemma2:2b</code>)</h3>
  <pre><code class="language-javascript">// rEngine/conversation-scribe.js
class ConversationScribe {
  constructor() {
    this.model = 'gemma2:2b';
    this.isProcessing = false;
    this.conversationBuffer = [];
    this.insights = new Map();
  }

  async processConversationTurn(userMessage, agentResponse) {
    const analysis = await this.analyzeExchange({
      user: userMessage,
      agent: agentResponse,
      timestamp: new Date().toISOString(),
      context: this.getRecentContext()
    });

    // Extract key insights automatically
    const insights = await this.extractInsights(analysis);
    
    // Store in memory engine
    await this.storeToMemory({
      exchange: { userMessage, agentResponse },
      insights: insights,
      keywords: this.extractKeywords(userMessage + agentResponse),
      decisions: this.extractDecisions(agentResponse),
      codeChanges: this.extractCodeChanges(agentResponse)
    });

    return insights;
  }

  async extractInsights(conversationAnalysis) {
    const prompt = ;

    return await this.queryOllama(prompt);
  }
}
</code></pre>
</section>

<section class="code-section">
  <h3>Dockerfile for Memory Engine</h3>
  <pre><code class="language-dockerfile"># rEngine/memory-engine.Dockerfile
FROM node:18-alpine

WORKDIR /memory-engine

# Install dependencies
COPY package.json ./
RUN npm install

# Copy memory engine
COPY src/ ./src/

# Expose search API
EXPOSE 5000

# Health check
HEALTHCHECK --interval=30s --timeout=3s   CMD curl -f http://localhost:5000/health || exit 1

CMD ["node", "src/memory-server.js"]
</code></pre>
</section>

<section class="code-section">
  <h3>Memory Server (<code>memory-server.js</code>)</h3>
  <pre><code class="language-javascript">// rEngine/memory-server.js
const express = require('express');
const { MemoryDatabase } = require('./memory-database');
const { ConversationIndex } = require('./conversation-index');

class MemorySearchEngine {
  constructor() {
    this.app = express();
    this.db = new MemoryDatabase();
    this.index = new ConversationIndex();
    
    this.setupRoutes();
  }

  setupRoutes() {
    // Search conversations by natural language
    this.app.post('/search/conversations', async (req, res) => {
      const { query, timeRange, agent, project } = req.body;
      
      const results = await this.index.search({
        query,
        filters: { timeRange, agent, project },
        limit: req.body.limit || 10
      });
      
      res.json(results);
    });

    // Get conversation context for agent
    this.app.post('/context/agent', async (req, res) => {
      const { agentId, currentTopic, lookbackDays = 7 } = req.body;
      
      const context = await this.buildAgentContext(
        agentId, 
        currentTopic, 
        lookbackDays
      );
      
      res.json(context);
    });

    // Store new conversation insights
    this.app.post('/store/insights', async (req, res) => {
      const { insights, metadata } = req.body;
      
      await this.db.storeInsights(insights, metadata);
      await this.index.updateIndex(insights);
      
      res.json({ success: true });
    });

    // Get persistent patterns
    this.app.get('/patterns/:category', async (req, res) => {
      const patterns = await this.db.getPatterns(req.params.category);
      res.json(patterns);
    });
  }

  async buildAgentContext(agentId, currentTopic, lookbackDays) {
    // Get relevant conversation history
    const conversations = await this.db.getConversations({
      agent: agentId,
      since: new Date(Date.now() - lookbackDays * 24 * 60 * 60 * 1000),
      topic: currentTopic
    });

    // Get learned preferences
    const preferences = await this.db.getUserPreferences(lookbackDays);

    // Get recent decisions
    const decisions = await this.db.getDecisions({
      since: new Date(Date.now() - lookbackDays * 24 * 60 * 60 * 1000),
      relevantTo: currentTopic
    });

    // Get code patterns
    const codePatterns = await this.db.getCodePatterns(currentTopic);

    return {
      conversations: conversations.slice(-5), // Most recent 5
      preferences,
      decisions,
      codePatterns,
      summary: await this.generateContextSummary({
        conversations, preferences, decisions, codePatterns
      })
    };
  }
}

const engine = new MemorySearchEngine();
engine.app.listen(5000, () => {
  console.log('🧠 rAgent Memory Engine running on port 5000');
});
</code></pre>
</section>

<section class="code-section">
  <h3>Memory Database (<code>memory-database.js</code>)</h3>
  <pre><code class="language-javascript">// rEngine/memory-database.js
class MemoryDatabase {
  constructor() {
    this.conversations = new Map();
    this.insights = new Map();
    this.patterns = new Map();
    this.preferences = new Map();
  }

  async storeConversation(data) {
    const id = this.generateId();
    
    const conversation = {
      id,
      timestamp: new Date().toISOString(),
      agent: data.agent,
      user_message: data.userMessage,
      agent_response: data.agentResponse,
      insights: data.insights,
      decisions: data.decisions,
      code_changes: data.codeChanges,
      keywords: data.keywords,
      project: data.project || 'StackTrackr',
      session_id: data.sessionId
    };

    this.conversations.set(id, conversation);
    
    // Update patterns
    await this.updatePatterns(conversation);
    
    return id;
  }

  async updatePatterns(conversation) {
    // Learn user preferences
    if (conversation.insights.preferences) {
      await this.updateUserPreferences(conversation.insights.preferences);
    }

    // Learn code patterns
    if (conversation.code_changes) {
      await this.updateCodePatterns(conversation.code_changes);
    }

    // Learn problem-solving patterns
    if (conversation.insights.problemSolved) {
      await this.updateProblemPatterns(conversation.insights.problemSolved);
    }
  }
}
</code></pre>
</section>

<section class="code-section">
  <h3>Memory Search Example</h3>
  <pre><code class="language-javascript">// Agent can query memory naturally
const memoryContext = await fetch('http://localhost:5000/search/conversations', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: 'table hover styling problems and solutions',
    timeRange: '30d',
    agent: 'github_copilot'
  })
});

// Returns:
{
  "results": [
    {
      "conversation_id": "conv_123",
      "timestamp": "2025-08-10T15:30:00Z",
      "relevance": 0.95,
      "summary": "Fixed table hover bug by adjusting CSS specificity",
      "decision": "Use :hover:nth-child() instead of generic :hover",
      "code_files": ["css/styles.css"],
      "outcome": "Successfully resolved hover state conflicts"
    }
  ],
  "patterns": [
    "User prefers minimal CSS changes",
    "Always test hover states on large datasets", 
    "Zebra striping + hover requires careful specificity"
  ]
}
</code></pre>
</section>

<section class="code-section">
  <h3>Agent Context Retrieval</h3>
  <pre><code class="language-javascript">// Before each conversation, agent gets context
const agentContext = await fetch('http://localhost:5000/context/agent', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    agentId: 'github_copilot',
    currentTopic: 'table styling bug fix',
    lookbackDays: 7
  })
});

// Agent now has:
// - Recent conversations about similar topics
// - User's preferences and patterns
// - Previous decisions and their outcomes  
// - Code patterns that worked before
</code></pre>
</section>

<section class="code-section">
  <h3>Ollama Scribe Installation and Testing</h3>
  <pre><code class="language-bash"># Install Ollama scribe model
ollama pull gemma2:2b

# Create conversation scribe
node rEngine/conversation-scribe.js --start

# Test basic conversation logging
curl -X POST http://localhost:3002/log-conversation   -d '{"user": "Fix table bug", "agent": "Analyzing css/styles.css..."}'
</code></pre>
</section>

<section class="code-section">
  <h3>Memory Engine Docker Build and Run</h3>
  <pre><code class="language-bash"># Build memory engine container
docker build -f rEngine/memory-engine.Dockerfile -t ragents-memory .

# Start memory engine
docker run -d -p 5000:5000   -v /Volumes/DATA/GitHub/StackTrackr/rMemory:/data   --name ragents-memory   ragents-memory

# Test memory search
curl -X POST http://localhost:5000/search/conversations   -d '{"query": "performance optimization"}'
</code></pre>
</section>

<section class="code-section">
  <h3>Package.json Memory Commands</h3>
  <pre><code class="language-bash"># Update package.json with memory commands
npm run memory:start     # Start Docker memory engine
npm run memory:search    # Interactive memory search
npm run memory:context   # Get current context for agents
npm run memory:insights  # View learned patterns
</code></pre>
</section>

<section class="code-section">
  <h3>Docker Compose Configuration</h3>
  <pre><code class="language-yaml"># docker-compose.yml
version: '3.8'
services:
  ragents-memory:
    build:
      context: .
      dockerfile: rEngine/memory-engine.Dockerfile
    ports:
      - "5000:5000"
    volumes:
      - ./rMemory:/data
      - ./rMemory/conversations:/conversations
    environment:
      - NODE_ENV=production
      - MEMORY_DB_PATH=/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  ragents-scribe:
    build:
      context: .
      dockerfile: rEngine/scribe.Dockerfile
    ports:
      - "3002:3002"
    depends_on:
      - ragents-memory
    environment:
      - OLLAMA_HOST=host.docker.internal:11434
      - MEMORY_ENGINE_URL=http://ragents-memory:5000
    restart: unless-stopped
</code></pre>
</section>

<section class="session-example">
  <h3>Session Examples</h3>
  <p><strong>Session 1:</strong> "Let's optimize the table rendering"</p>
  <p><strong>Session 2:</strong> "What were we working on?" (context lost)</p>
  <p><strong>Improved Session 2:</strong> Agent: "Continuing table optimization - I remember we identified hover state issues in css/styles.css and you prefer minimal changes. The zebra striping pattern from last week worked well."</p>
</section>

<section class="metadata">
  <h3>Metadata (Incomplete/Problematic Data)</h3>
  <p>The following section contains incomplete or problematic data and is included for completeness.</p>
  <pre><code>conversation-memory-engine.mddescribes:      cannot open `describes' (No such file or directory)
the:            cannot open `the' (No such file or directory)
architecture:   cannot open `architecture' (No such file or directory)
and:            empty
implementation: cannot open `implementation' (No such file or directory)
details:        cannot open `details' (No such file or directory)
of:             cannot open `of' (No such file or directory)
the:            cannot open `the' (No such file or directory)
rAgent:         cannot open `rAgent' (No such file or directory)
Conversation:   cannot open `Conversation' (No such file or directory)
Memory:         cannot open `Memory' (No such file or directory)
Engine,:        cannot open `Engine,' (No such file or directory)
a:              cannot open `a' (No such file or directory)
key:            cannot open `key' (No such file or directory)
component:      cannot open `component' (No such file or directory)
in:             cannot open `in' (No such file or directory)
the:            cannot open `the' (No such file or directory)
rEngine:        directory
Core:           cannot open `Core' (No such file or directory)
ecosystem.:     cannot open `ecosystem.' (No such file or directory)
This:           cannot open `This' (No such file or directory)
engine:         cannot open `engine' (No such file or directory)
provides:       cannot open `provides' (No such file or directory)
a:              cannot open `a' (No such file or directory)
persistent,:    cannot open `persistent,' (No such file or directory)
searchable:     cannot open `searchable' (No such file or directory)
conversation:   cannot open `conversation' (No such file or directory)
memory:         cannot open `memory' (No such file or directory)
system:         cannot open `system' (No such file or directory)
that:           cannot open `that' (No such file or directory)
gives:          cannot open `gives' (No such file or directory)
agents:         directory
human-like:     cannot open `human-like' (No such file or directory)
continuity:     cannot open `continuity' (No such file or directory)
across:         cannot open `across' (No such file or directory)
sessions,:      cannot open `sessions,' (No such file or directory)
projects,:      cannot open `projects,' (No such file or directory)
and:            empty
time.:          cannot open `time.' (No such file or directory)
</code></pre>
</section>
```


[36mℹ️  Duration: 23559ms | Model: gemini-1.5-flash[0m
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="../index.html">Home</a>
                <a href="../README.html">Documentation</a>
                <a href="https://github.com/lbruton/StackTrackr">GitHub</a>
            </div>
            <p>Generated on 2025-08-20 by rEngine Core HTML Converter</p>
            <p>© 2025 rEngine Core - Intelligent Development Wrapper</p>
        </div>
    </footer>
</body>
</html>