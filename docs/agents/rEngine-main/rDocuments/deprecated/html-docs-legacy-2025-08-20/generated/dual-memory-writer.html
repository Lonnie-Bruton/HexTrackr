<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dual-memory-writer - StackTrackr Documentation</title>
    <style>
        :root {
            --rengine-primary: #667eea;
            --rengine-secondary: #764ba2;
            --rengine-accent: #495057;
            --rengine-accent-light: #6c757d;
            --status-success: #28a745;
            --status-warning: #ffc107;
            --status-danger: #dc3545;
            --status-info: #007acc;
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #888;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --border-color: #e1e4e8;
            --shadow-heavy: 0 20px 40px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--rengine-primary) 0%, var(--rengine-secondary) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-primary);
            border-radius: 15px;
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--rengine-accent) 0%, var(--rengine-accent-light) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .header .meta {
            font-size: 0.9em;
            opacity: 0.7;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-bar {
            background: var(--bg-secondary);
            padding: 15px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 8px 16px;
            background: var(--status-info);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .content {
            padding: 40px;
            max-width: none;
        }

        .content h1, .content h2, .content h3 { 
            color: var(--text-primary); 
            margin-top: 2em; 
            margin-bottom: 0.5em; 
        }
        .content h1 { font-size: 2em; border-bottom: 2px solid var(--rengine-primary); padding-bottom: 0.5em; }
        .content h2 { font-size: 1.5em; }
        .content h3 { font-size: 1.3em; }
        
        .content pre { 
            background: var(--bg-secondary); 
            padding: 1em; 
            border-radius: 5px; 
            overflow-x: auto; 
            margin: 1em 0;
            border: 1px solid var(--border-color);
        }
        
        .content code { 
            background: var(--bg-secondary); 
            padding: 0.2em 0.4em; 
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        
        .content blockquote {
            border-left: 4px solid var(--rengine-primary);
            margin: 1em 0;
            padding-left: 1em;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            padding: 1em 1em 1em 2em;
            border-radius: 5px;
        }
        
        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .content th, .content td {
            border: 1px solid var(--border-color);
            padding: 0.75em;
            text-align: left;
        }
        
        .content th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .content a {
            color: var(--status-info);
            text-decoration: none;
        }

        .content a:hover {
            text-decoration: underline;
        }

        .metadata {
            background: var(--bg-secondary);
            padding: 1em;
            border-radius: 5px;
            margin-bottom: 2em;
            font-size: 0.9em;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .footer {
            background: var(--bg-secondary);
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .footer .branding {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .footer .system-name {
            font-weight: 600;
            color: var(--rengine-accent);
        }

        .footer .version {
            color: var(--text-muted);
            font-style: italic;
        }

        .footer .divider {
            color: var(--text-muted);
            opacity: 0.5;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
            
            .nav-bar {
                padding: 10px 20px;
            }
            
            .footer .branding {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-icon">üìÑ</div>
            <h1>dual-memory-writer</h1>
            <div class="subtitle">StackTrackr Documentation</div>
            <div class="meta">
                <span>üìÅ dual-memory-writer.md</span>
                <span>üìÖ 2025-08-20</span>
                
            </div>
        </header>
        
        <nav class="nav-bar">
            <div class="nav-links">
                <a href="../../html-docs/documentation.html" class="nav-link">üè† Documentation Portal</a>
                <a href="../index.html" class="nav-link">üìö All Docs</a>
                <a href="../../html-docs/developmentstatus.html" class="nav-link">üìä Development Status</a>
            </div>
        </nav>
        
        <main class="content">
            <div class="metadata">
                <strong>üìÇ Source File:</strong> dual-memory-writer.md | 
                <strong>üïí Generated:</strong> 8/19/2025, 9:45:41 PM |
                <strong>üé® Engine:</strong> Gemini HTML Converter
            </div>
            ```html
<h1>Dual Memory Writer</h1>

<h2>Purpose & Overview</h2>

<p>The <code>dual-memory-writer.js</code> script is a utility that ensures all agents write their memory data to both a persistent memory store (<code>persistent-memory.json</code>) and an agent-specific memory file (<code>agent-type-memory.json</code>). It also writes a summary of the memory write operation to an extended context file (<code>extendedcontext.json</code>). This redundancy helps maintain data integrity and ensures that agent memory is consistently available across different parts of the system.</p>

<p>The script includes JSON data sanitization and error handling to provide a robust and reliable memory writing solution.</p>

<h2>Technical Architecture</h2>

<p>The <code>DualMemoryWriter</code> class is the main component of this script. It has the following key properties and methods:</p>

<h3>Properties</h3>
<ul>
  <li><code>baseDir</code>: The base directory of the project.</li>
  <li><code>persistentMemoryPath</code>: The file path for the persistent memory store.</li>
  <li><code>agentMemoryDir</code>: The directory where agent-specific memory files are stored.</li>
  <li><code>extendedContextPath</code>: The file path for the extended context file.</li>
</ul>

<h3>Methods</h3>
<ul>
  <li><code>sanitizeForJSON(data)</code>: Sanitizes the input data to prevent JSON parsing errors.</li>
  <li><code>writeToPersistentMemory(entry)</code>: Writes the provided memory entry to the persistent memory store.</li>
  <li><code>writeToAgentMemory(agentType, entry)</code>: Writes the provided memory entry to the agent-specific memory file.</li>
  <li><code>writeToExtendedContext(entry)</code>: Writes a summary of the memory write operation to the extended context file.</li>
  <li><code>dualWrite(agentType, entry)</code>: Orchestrates the dual writing process by calling the above methods in parallel.</li>
</ul>

<p>The data flow in this script is as follows:</p>

<ol>
  <li>The <code>dualWrite</code> method is called with an <code>agentType</code> and a memory <code>entry</code> object.</li>
  <li>The method calls <code>writeToPersistentMemory</code>, <code>writeToAgentMemory</code>, and <code>writeToExtendedContext</code> in parallel.</li>
  <li>Each of these methods reads the corresponding file, updates it with the provided data, and writes the file back.</li>
  <li>The <code>dualWrite</code> method returns a boolean indicating the overall success of the dual write operation.</li>
</ol>

<h2>Dependencies</h2>

<p>This script imports the following dependencies:</p>
<ul>
  <li><code>fs/promises</code>: The file system module, used for reading and writing files.</li>
  <li><code>path</code>: The path module, used for managing file paths.</li>
  <li><code>fileURLToPath</code>: A utility function from the <code>url</code> module, used to convert a file URL to a file path.</li>
</ul>

<h2>Key Functions/Classes</h2>

<h3><code>DualMemoryWriter</code> Class</h3>

<p>The <code>DualMemoryWriter</code> class is the main component of this script. It has the following key methods:</p>

<h4><code>sanitizeForJSON(data)</code></h4>
<ul>
  <li><strong>Purpose</strong>: Sanitizes the input data to prevent JSON parsing errors.</li>
  <li><strong>Parameters</strong>: <code>data</code> (any): The data to be sanitized.</li>
  <li><strong>Return Value</strong>: The sanitized data.</li>
</ul>

<h4><code>writeToPersistentMemory(entry)</code></h4>
<ul>
  <li><strong>Purpose</strong>: Writes the provided memory entry to the persistent memory store.</li>
  <li><strong>Parameters</strong>: <code>entry</code> (object): The memory entry to be written.</li>
  <li><strong>Return Value</strong>: <code>true</code> if the write operation was successful, <code>false</code> otherwise.</li>
</ul>

<h4><code>writeToAgentMemory(agentType, entry)</code></h4>
<ul>
  <li><strong>Purpose</strong>: Writes the provided memory entry to the agent-specific memory file.</li>
  <li><strong>Parameters</strong>: <code>agentType</code> (string): The type of the agent, <code>entry</code> (object): The memory entry to be written.</li>
  <li><strong>Return Value</strong>: <code>true</code> if the write operation was successful, <code>false</code> otherwise.</li>
</ul>

<h4><code>writeToExtendedContext(entry)</code></h4>
<ul>
  <li><strong>Purpose</strong>: Writes a summary of the memory write operation to the extended context file.</li>
  <li><strong>Parameters</strong>: <code>entry</code> (object): The memory entry to be written.</li>
  <li><strong>Return Value</strong>: <code>true</code> if the write operation was successful, <code>false</code> otherwise.</li>
</ul>

<h4><code>dualWrite(agentType, entry)</code></h4>
<ul>
  <li><strong>Purpose</strong>: Orchestrates the dual writing process by calling the above methods in parallel.</li>
  <li><strong>Parameters</strong>: <code>agentType</code> (string): The type of the agent, <code>entry</code> (object): The memory entry to be written.</li>
  <li><strong>Return Value</strong>: <code>true</code> if at least 2 out of 3 write operations were successful, <code>false</code> otherwise.</li>
</ul>

<h2>Usage Examples</h2>

<p>To use the <code>DualMemoryWriter</code> class, you can create an instance and call the <code>dualWrite</code> method:</p>

<pre><code class="language-javascript">
import DualMemoryWriter from './dual-memory-writer.js';

const writer = new DualMemoryWriter();
const agentType = 'claude';
const title = 'Test Entry';
const content = 'Test dual memory write';

await writer.dualWrite(agentType, { title, content, type: 'test' });
</code></pre>

<p>This will write the provided memory entry to the persistent memory store, the agent-specific memory file, and the extended context file.</p>

<h2>Configuration</h2>

<p>This script does not have any configuration options or environment variables. The file paths for the persistent memory store, agent-specific memory files, and extended context file are hardcoded in the <code>DualMemoryWriter</code> class.</p>

<h2>Error Handling</h2>

<p>The script uses try-catch blocks to handle errors that may occur during the file reading and writing operations. If an error occurs, the corresponding error message is logged to the console, and the relevant write operation is considered a failure.</p>

<h2>Integration</h2>

<p>The <code>dual-memory-writer.js</code> script is designed to be integrated into a larger system that uses agent-based memory management. It can be used to ensure that all agent memory updates are consistently recorded in multiple locations, improving data redundancy and reliability.</p>

<h2>Development Notes</h2>

<ul>
  <li>The <code>sanitizeForJSON</code> method is crucial to prevent JSON parsing errors that may occur due to special characters or control characters in the input data.</li>
  <li>The script uses the <code>path</code> module to construct file paths in a platform-independent manner.</li>
  <li>The <code>dualWrite</code> method considers the overall operation a success if at least 2 out of 3 write operations are successful. This provides a degree of fault tolerance and ensures that the system can continue to function even if one of the write operations fails.</li>
  <li>The script includes a placeholder for integrating with an MCP (Master Control Plane) memory store, which can be implemented if needed.</li>
</ul>
```
        </main>
        
        <footer class="footer">
            <div class="branding">
                <span>Generated from the <span class="system-name">rScribe Document System</span></span>
                <span class="divider">‚Ä¢</span>
                <span class="system-name">rEngine</span> <span class="version">(v2.1.0)</span>
                <span class="divider">‚Ä¢</span>
                <span>Last updated: 2025-08-20</span>
            </div>
        </footer>
    </div>
</body>
</html>