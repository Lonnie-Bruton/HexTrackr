<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version Change Detection and Changelog Display - StackTrackr Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .header .meta {
            font-size: 0.9em;
            opacity: 0.7;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e4e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 8px 16px;
            background: #007acc;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .content {
            padding: 40px;
            max-width: none;
        }

        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            color: #2c3e50;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .content h1 { font-size: 2.2em; border-bottom: 3px solid #007acc; padding-bottom: 10px; }
        .content h2 { font-size: 1.8em; color: #007acc; }
        .content h3 { font-size: 1.4em; color: #495057; }
        .content h4 { font-size: 1.2em; color: #6c757d; }

        .content p {
            margin-bottom: 16px;
            line-height: 1.7;
            color: #444;
        }

        .content ul, .content ol {
            margin-bottom: 16px;
            padding-left: 25px;
        }

        .content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .content blockquote {
            border-left: 4px solid #007acc;
            background: #f8f9fa;
            margin: 20px 0;
            padding: 15px 20px;
            border-radius: 0 6px 6px 0;
        }

        .content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        .content pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .content pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .content th, .content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e1e4e8;
        }

        .content th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .content tr:hover {
            background: #f8f9fa;
        }

        .content a {
            color: #007acc;
            text-decoration: none;
            font-weight: 500;
        }

        .content a:hover {
            color: #0056b3;
            text-decoration: underline;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px 30px;
            border-top: 1px solid #e1e4e8;
            text-align: center;
            color: #6c757d;
            font-size: 0.9em;
        }

        .doc-meta {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #007acc;
        }

        .doc-meta h3 {
            color: #007acc;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .meta-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }

        .meta-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .meta-value {
            color: #6c757d;
            font-size: 0.9em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .content { padding: 20px; }
            .header { padding: 20px; }
            .nav-bar { padding: 15px 20px; }
            .nav-links { justify-content: center; }
            .header .meta { flex-direction: column; gap: 10px; }
        }

        /* Category-specific colors */
        .color-vision { --primary: #9c27b0; --secondary: #7b1fa2; }
        .color-roadmap { --primary: #007acc; --secondary: #0056b3; }
        .color-engine { --primary: #2c3e50; --secondary: #34495e; }
        .color-agent { --primary: #28a745; --secondary: #198754; }
        .color-brain { --primary: #6f42c1; --secondary: #495057; }
        .color-docker { --primary: #0db7ed; --secondary: #086dd7; }
        .color-mobile { --primary: #fd7e14; --secondary: #dc3545; }
        .color-protocol { --primary: #20c997; --secondary: #198754; }
        .color-scribe { --primary: #17a2b8; --secondary: #138496; }
        .color-groq { --primary: #ffc107; --secondary: #e0a800; }
        .color-task { --primary: #dc3545; --secondary: #c82333; }
        .color-cleanup { --primary: #6c757d; --secondary: #5a6268; }
        .color-quickstart { --primary: #28a745; --secondary: #198754; }
        .color-patch { --primary: #ff6b35; --secondary: #e55a32; }
        .color-rengine { --primary: #8b5cf6; --secondary: #7c3aed; }
        .color-default { --primary: #495057; --secondary: #6c757d; }
    </style>
</head>
<body class="color-default">
    <div class="container">
        <header class="header">
            <div class="header-icon">üìÑ</div>
            <h1>Version Change Detection and Changelog Display</h1>
            <div class="subtitle">Documentation</div>
            <div class="meta">
                <span>üìÅ versionCheck.md</span>
                <span>üìÖ 2025-08-20</span>
                <span>üìä 8KB</span>
            </div>
        </header>

        <nav class="nav-bar">
            <div class="nav-links">
                <a href="../index.html" class="nav-link">üè† Documentation Home</a>
                <a href="../developmentstatus.html" class="nav-link">üìä Development Status</a>
                <a href="../rProjects/StackTrackr/js/versionCheck.md" class="nav-link">üìù View Source MD</a>
                <a href="../json/versionCheck.json" class="nav-link">üîß JSON Data</a>
            </div>
        </nav>

        <main class="content">
            <h1 id="version-change-detection-and-changelog-display">Version Change Detection and Changelog Display</h1>
<h2 id="purpose--overview">Purpose &amp; Overview</h2>
<p>The <code>versionCheck.js</code> script is responsible for detecting changes in the application&#39;s version and displaying a changelog modal to the user. It compares the stored version in the user&#39;s local storage with the current version, and if there&#39;s a difference, it fetches the corresponding changelog from a markdown file and presents it in a modal window.</p>
<p>This script ensures that users are aware of the changes and improvements made to the application, providing a seamless and transparent update experience.</p>
<h2 id="technical-architecture">Technical Architecture</h2>
<p>The script is divided into several key components:</p>
<ol>
<li><strong><code>checkVersionChange()</code></strong>: This function is the main entry point, responsible for checking the version stored in the user&#39;s local storage and displaying the changelog modal if a change is detected.</li>
<li><strong><code>getChangelogForVersion()</code></strong>: This function extracts the changelog section for a specific version from the full changelog markdown text.</li>
<li><strong><code>populateVersionModal()</code></strong>: This function populates the version modal with the current version and the corresponding changelog, and then displays the modal.</li>
<li><strong><code>getEmbeddedChangelog()</code></strong>: This function provides a fallback mechanism for displaying the changelog when the fetch request for the markdown file fails, by using embedded changelog data.</li>
<li><strong><code>setupVersionModalEvents()</code></strong>: This function sets up the event handlers for the version modal, including accepting the version change and closing the modal.</li>
</ol>
<p>The script listens for the <code>DOMContentLoaded</code> event and calls the <code>checkVersionChange()</code> function to initiate the version change detection process.</p>
<h2 id="dependencies">Dependencies</h2>
<p>The <code>versionCheck.js</code> script does not have any external dependencies. It relies on the following global variables and functions:</p>
<ul>
<li><code>LS_KEY</code>: The key used to store data in the user&#39;s local storage.</li>
<li><code>VERSION_ACK_KEY</code>: The key used to store the acknowledged version in the user&#39;s local storage.</li>
<li><code>APP_VERSION</code>: The current version of the application.</li>
<li><code>showAckModal()</code>: A function that displays an acknowledgment modal (if available).</li>
<li><code>loadAnnouncements()</code>: A function that loads and displays application announcements (if available).</li>
<li><code>sanitizeHtml()</code>: A function that sanitizes HTML input to prevent XSS attacks.</li>
</ul>
<h2 id="key-functionsclasses">Key Functions/Classes</h2>
<ol>
<li><p><strong><code>checkVersionChange()</code></strong></p>
<ul>
<li>Parameters: None</li>
<li>Return Value: None</li>
<li>Description: Checks the stored version in the user&#39;s local storage and displays the changelog modal if a change is detected.</li>
</ul>
</li>
<li><p><strong><code>getChangelogForVersion()</code></strong></p>
<ul>
<li>Parameters:<ul>
<li><code>text</code>: The full changelog markdown text.</li>
<li><code>version</code>: The version string to extract the changelog for.</li>
</ul>
</li>
<li>Return Value: An HTML string containing the changelog items for the specified version.</li>
<li>Description: Extracts the changelog section for a specific version from the full changelog markdown text.</li>
</ul>
</li>
<li><p><strong><code>populateVersionModal()</code></strong></p>
<ul>
<li>Parameters:<ul>
<li><code>version</code>: The current application version.</li>
<li><code>html</code>: The HTML content of the changelog.</li>
</ul>
</li>
<li>Return Value: None</li>
<li>Description: Populates and displays the version modal with the current version and the corresponding changelog.</li>
</ul>
</li>
<li><p><strong><code>getEmbeddedChangelog()</code></strong></p>
<ul>
<li>Parameters:<ul>
<li><code>version</code>: The version to get the changelog for.</li>
</ul>
</li>
<li>Return Value: An HTML string containing the changelog items for the specified version.</li>
<li>Description: Provides embedded changelog data as a fallback when the fetch request for the markdown file fails.</li>
</ul>
</li>
<li><p><strong><code>setupVersionModalEvents()</code></strong></p>
<ul>
<li>Parameters:<ul>
<li><code>version</code>: The current application version.</li>
</ul>
</li>
<li>Return Value: None</li>
<li>Description: Sets up the event handlers for the version modal, including accepting the version change and closing the modal.</li>
</ul>
</li>
</ol>
<h2 id="usage-examples">Usage Examples</h2>
<p>The <code>versionCheck.js</code> script is typically included in the main HTML file of the application, often near the end of the <code>&lt;body&gt;</code> section. It will automatically check for version changes and display the changelog modal when necessary.</p>
<pre><code class="language-html"><pre><code class="language-html"><!DOCTYPE html>
<html>
<head>
  <title>My Application</title>
  <!-- Other HTML content -->
</head>
<body>
  <!-- Application content -->

  <!-- Version modal -->
  <div id="versionModal" class="modal">
    <div class="modal-content">
      <h2>Version Update <span id="versionModalVersion"></span></h2>
      <div id="versionChanges"></div>
      <div class="modal-buttons">
        <button id="versionAcceptBtn">Got it</button>
        <button id="versionCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Load the version check script -->
  <script src="versionCheck.js"></script>
</body>
</html></code></pre>
</code></pre>
<h2 id="configuration">Configuration</h2>
<p>The <code>versionCheck.js</code> script relies on the following configuration options and environment variables:</p>
<ul>
<li><code>LS_KEY</code>: The key used to store data in the user&#39;s local storage.</li>
<li><code>VERSION_ACK_KEY</code>: The key used to store the acknowledged version in the user&#39;s local storage.</li>
<li><code>APP_VERSION</code>: The current version of the application.</li>
</ul>
<p>These values should be defined and maintained separately, as they are used throughout the application.</p>
<h2 id="error-handling">Error Handling</h2>
<p>The <code>versionCheck.js</code> script handles the following potential errors:</p>
<ol>
<li><strong>Fetch Error</strong>: If the fetch request for the changelog markdown file fails, the script will display a fallback changelog using the <code>getEmbeddedChangelog()</code> function.</li>
<li><strong>Changelog Parsing Error</strong>: If the markdown file cannot be parsed correctly, the script will display a message indicating that no changelog entry was found.</li>
</ol>
<p>In both cases, the script will log the error to the console for debugging purposes.</p>
<h2 id="integration">Integration</h2>
<p>The <code>versionCheck.js</code> script is designed to be integrated into the larger application system. It relies on the following external functions and variables:</p>
<ul>
<li><code>showAckModal()</code>: A function that displays an acknowledgment modal (if available) when no version data is found in the user&#39;s local storage.</li>
<li><code>loadAnnouncements()</code>: A function that loads and displays application announcements (if available) when the version modal is shown.</li>
<li><code>sanitizeHtml()</code>: A function that sanitizes HTML input to prevent XSS attacks.</li>
</ul>
<p>These dependencies should be provided or implemented by the application to ensure the smooth functioning of the version change detection and changelog display.</p>
<h2 id="development-notes">Development Notes</h2>
<ol>
<li><p><strong>Changelog Markdown Format</strong>: The script expects the changelog to be formatted in Markdown, with each version change listed under a heading in the format <code>### Version x.xx.xx</code>. This allows the script to parse the changelog and extract the relevant section for the current version.</p>
</li>
<li><p><strong>Local Storage Usage</strong>: The script uses the user&#39;s local storage to store the current version and the acknowledged version. This ensures that the changelog modal is only displayed when there&#39;s a new version, and not every time the user visits the application.</p>
</li>
<li><p><strong>Fallback Changelog</strong>: The <code>getEmbeddedChangelog()</code> function provides a fallback mechanism for displaying the changelog when the fetch request for the markdown file fails. This could happen in certain environments or scenarios where the markdown file is not accessible.</p>
</li>
<li><p><strong>Modal Event Handling</strong>: The <code>setupVersionModalEvents()</code> function sets up the event handlers for the version modal, including accepting the version change and closing the modal. This ensures a consistent user experience when interacting with the version update notification.</p>
</li>
<li><p><strong>Accessibility Considerations</strong>: The script sets the <code>overflow</code> property of the <code>&lt;body&gt;</code> element to <code>&quot;hidden&quot;</code> when the version modal is displayed, to prevent scrolling behind the modal. This should be considered when integrating the script into the larger application, as it may affect the overall layout and accessibility of the page.</p>
</li>
</ol>

        </main>

        <footer class="footer">
            <p>Generated from <strong>versionCheck.md</strong> ‚Ä¢ StackTrackr Documentation System ‚Ä¢ Last updated: 2025-08-20</p>
        </footer>
    </div>
</body>
</html>