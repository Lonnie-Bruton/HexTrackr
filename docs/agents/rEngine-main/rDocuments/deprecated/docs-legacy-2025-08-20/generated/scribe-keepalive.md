# rEngine Core: scribe-keepalive.sh

## Purpose & Overview

The `scribe-keepalive.sh` script is a crucial component in the rEngine Core ecosystem, responsible for monitoring the health and status of the Smart Scribe system. This script performs the following key tasks:

1. Sends a "keep-alive" message to the Smart Scribe system, ensuring that it is responsive and operational.
2. Checks the health of the Ollama service, which is the underlying language model used by the Smart Scribe.
3. Verifies that the Smart Scribe process is running, and attempts to start it if it's not.
4. Generates a status report, which can be used for monitoring and troubleshooting purposes.

This script is designed to run periodically (e.g., as a cron job) to proactively monitor the health of the Smart Scribe system and the Ollama service, ensuring that the rEngine Core platform remains reliable and responsive.

## Key Functions/Classes

The `scribe-keepalive.sh` script defines the following key functions:

1. `send_keepalive()`: Sends a "keep-alive" message to the Smart Scribe system and verifies the response.
2. `check_ollama()`: Checks the health of the Ollama service and ensures that the required language model is loaded.
3. `trigger_scribe_healthcheck()`: Checks if the Smart Scribe process is running and attempts to start it if it's not.
4. `create_status_report()`: Generates a JSON-formatted status report, which includes information about the Ollama service, the Smart Scribe process, and the last keep-alive response.

These functions work together to provide a comprehensive health check and monitoring system for the Smart Scribe component within the rEngine Core platform.

## Dependencies

The `scribe-keepalive.sh` script has the following dependencies:

- **Ollama Service**: The script communicates with the Ollama service, which is the underlying language model used by the Smart Scribe.
- **Smart Scribe Process**: The script interacts with the `smart-scribe.js` process, which is the main component responsible for the Smart Scribe functionality.
- **cURL**: The script uses the cURL command-line tool to communicate with the Ollama service.
- **Python 3**: The script uses Python 3 to parse the JSON responses from the Ollama service.

## Usage Examples

The `scribe-keepalive.sh` script can be used in the following ways:

1. **Periodic Health Check and Keep-Alive**:

   ```bash
   ./scribe-keepalive.sh
   ```

   This is the default behavior of the script, which performs a full health check, sends a keep-alive message, and generates a status report.

1. **Check System Status**:

   ```bash
   ./scribe-keepalive.sh status
   ```

   This command will check the status of the Ollama service and the Smart Scribe process, and generate a status report without sending a keep-alive message.

1. **Start Smart Scribe Process**:

   ```bash
   ./scribe-keepalive.sh start
   ```

   This command will attempt to start the Smart Scribe process if it's not running.

1. **Test Keep-Alive Message**:

   ```bash
   ./scribe-keepalive.sh test
   ```

   This command will only test the keep-alive message, without performing the full health check.

## Configuration

The `scribe-keepalive.sh` script relies on the following configuration:

- `OLLAMA_ENDPOINT`: The URL of the Ollama service, which is set to `http://localhost:11434` by default.
- `MODEL`: The name of the language model used by the Smart Scribe, which is set to `qwen2.5-coder:3b` by default.

These values can be adjusted as needed to match the specific deployment of the rEngine Core platform.

## Integration Points

The `scribe-keepalive.sh` script is a crucial component in the rEngine Core ecosystem, as it ensures the health and reliability of the Smart Scribe system. It is designed to work seamlessly with the following rEngine Core components:

1. **Ollama Service**: The script communicates with the Ollama service to ensure that the required language model is loaded and available.
2. **Smart Scribe Process**: The script monitors the status of the `smart-scribe.js` process and attempts to start it if it's not running.
3. **Monitoring and Alerting**: The status report generated by the script can be used for monitoring and alerting purposes, allowing the rEngine Core platform to proactively detect and address any issues with the Smart Scribe system.

## Troubleshooting

Here are some common issues and solutions related to the `scribe-keepalive.sh` script:

1. **Ollama Service Not Responding**:
   - Check the URL and port of the Ollama service in the `OLLAMA_ENDPOINT` variable.
   - Ensure that the Ollama service is running and accessible.
   - Check the Ollama service logs for any errors or issues.

1. **Smart Scribe Process Not Running**:
   - Verify that the `smart-scribe.js` process is running by checking the output of the `pgrep` command.
   - Check the logs of the `smart-scribe.js` process for any errors or issues.
   - Ensure that the `node` command is available and accessible in the system's PATH.

1. **Unexpected Keep-Alive Response**:
   - Verify that the language model specified in the `MODEL` variable is loaded and available in the Ollama service.
   - Check the Ollama service logs for any errors or issues related to the language model.
   - Ensure that the "Cool Runnings" keep-alive message is being sent correctly.

If you encounter any other issues, please refer to the rEngine Core documentation or contact the support team for further assistance.
