# Smart Scribe Memory Health Monitor

## Purpose & Overview

The `smart-scribe-memory-monitor.js` file is a part of the rEngine Core ecosystem and provides a comprehensive memory health monitoring solution for the Smart Scribe application. This module integrates with the Smart Scribe platform to ensure the reliability and consistency of the memory management system.

The main functionalities of this module include:

1. **Real-time Memory Health Checks**: Continuously monitors the memory usage and integrity during Smart Scribe operations.
2. **MCP Server Connectivity Validation**: Verifies the availability and accessibility of the MCP (Memory Control Plane) server.
3. **Local Memory File Integrity Verification**: Checks the validity and staleness of critical memory-related files stored locally.
4. **Automatic Sync Gap Detection**: Identifies any discrepancies between the MCP server and the local memory storage, ensuring seamless synchronization.
5. **Integration with Smart Scribe Monitoring**: Provides a comprehensive health report that can be integrated into the existing Smart Scribe monitoring system.

## Key Functions/Classes

The `SmartScribeMemoryMonitor` class is the main component of this module and handles the various memory health-related tasks.

### `SmartScribeMemoryMonitor` Class

- `constructor()`: Initializes the class with the necessary file paths and configuration parameters.
- `checkMCPConnectivity()`: Checks the availability and accessibility of the MCP server.
- `validateLocalMemory()`: Validates the integrity of the critical memory-related files stored locally.
- `checkSyncGaps()`: Detects any gaps in the synchronization between the MCP server and the local memory storage.
- `performHealthCheck()`: Performs a comprehensive memory health check by combining the results of the above functions.
- `formatForSmartScribe()`: Formats the health report in a way that is compatible with the Smart Scribe monitoring system.
- `getMemoryHealthForScribe()`: Provides the memory health report for integration with the Smart Scribe monitoring system.
- `quickConnectivityTest()`: Performs a quick connectivity test to determine the overall readiness of the Smart Scribe application.

## Dependencies

The `smart-scribe-memory-monitor.js` file depends on the following external modules:

- `fs-extra`: Provides file system-related utilities, such as reading and writing JSON files.
- `path`: Handles file path operations.
- `child_process`: Allows the execution of system commands.

## Usage Examples

The `smart-scribe-memory-monitor.js` file can be used in the following ways:

1. **Performing a Memory Health Check**:

```javascript
const monitor = new SmartScribeMemoryMonitor();
const healthReport = await monitor.performHealthCheck();
console.log(healthReport);
```

1. **Integrating with Smart Scribe Monitoring**:

```javascript
const monitor = new SmartScribeMemoryMonitor();
const scribeHealthReport = await monitor.getMemoryHealthForScribe();
console.log(scribeHealthReport);
```

1. **Running a Quick Connectivity Test**:

```javascript
const monitor = new SmartScribeMemoryMonitor();
const connectivityTest = await monitor.quickConnectivityTest();
console.log(connectivityTest);
```

## Configuration

The `SmartScribeMemoryMonitor` class has the following configuration parameters:

| Parameter | Description | Default Value |
| --- | --- | --- |
| `baseDir` | The base directory for the rEngine Core project | `/Volumes/DATA/GitHub/rEngine` |
| `memoryDir` | The directory containing the memory-related files | `path.join(this.baseDir, 'rMemory', 'rAgentMemories')` |
| `logDir` | The directory for storing the memory health reports | `path.join(this.baseDir, 'logs')` |
| `criticalFiles` | The list of critical memory-related files to monitor | `['memory.json', 'handoff.json', 'tasks.json', 'persistent-memory.json', 'mcp-sync-summary.json']` |
| `maxFileAge` | The maximum allowed age for the memory-related files (in milliseconds) | `24 * 60 * 60 * 1000` (24 hours) |
| `checkInterval` | The interval for performing the memory health check (in milliseconds) | `15 * 60 * 1000` (15 minutes) |

## Integration Points

The `smart-scribe-memory-monitor.js` file integrates with the following rEngine Core components:

1. **Smart Scribe**: The memory health report generated by this module can be directly integrated into the Smart Scribe monitoring system, providing a comprehensive view of the memory health.
2. **MCP Server**: The module relies on the availability and accessibility of the MCP server to ensure the integrity of the memory management system.
3. **Local Memory Storage**: The module validates the critical memory-related files stored locally, ensuring the continuity of the Smart Scribe application.

## Troubleshooting

Here are some common issues and their solutions:

1. **MCP Server Unavailable**: If the MCP server is not running or accessible, the Smart Scribe application will fall back to using the local memory storage. This may result in a warning or critical status in the memory health report.
   - **Solution**: Ensure that the MCP server is running and accessible from the Smart Scribe context.

1. **Local Memory File Issues**: If critical memory-related files are missing or corrupted, the memory health report will indicate a critical status.
   - **Solution**: Investigate the local memory directory and ensure that all critical files are present and have a valid JSON structure.

1. **Sync Gaps**: If the synchronization between the MCP server and the local memory storage is not happening as expected, the memory health report will indicate a warning or critical status.
   - **Solution**: Investigate the `mcp-sync-summary.json` file and ensure that the synchronization is working as expected. If there are any issues, run the automated sync process to resolve the discrepancies.

1. **Unexpected Errors**: If the memory health check encounters any unexpected errors, the report will indicate a critical status.
   - **Solution**: Check the log files for more information about the errors and investigate the root cause of the issues.

By addressing these common issues, you can ensure the smooth operation of the Smart Scribe application and maintain the integrity of the memory management system.
