#!/bin/bash

# Quick AI consultation script for GPT
# Usage: ./heygpt "your question"

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Load environment variables for API keys
if [ -f "$PROJECT_ROOT/rEngine/.env" ]; then
    source "$PROJECT_ROOT/rEngine/.env"
fi

QUESTION="$1"
if [ -z "$QUESTION" ]; then
    echo "Usage: $0 'your question'"
    exit 1
fi

# Add context about current project state
CONTEXT="Project: StackTrackr - Memory System Assessment
Current Status: Memory Scribe with real-time console monitoring active
Recent Changes: Implemented comprehensive memory monitoring with 15-min health checks
Question: $QUESTION"

# Call OpenAI API
if [ -n "$OPENAI_API_KEY" ]; then
    curl -s -X POST \
        "https://api.openai.com/v1/chat/completions" \
        -H "Content-Type: application/json" \
        -H "Authorization: Bearer $OPENAI_API_KEY" \
        -d "{
            \"model\": \"gpt-4o\",
            \"messages\": [
                {\"role\": \"user\", \"content\": \"$CONTEXT\"}
            ],
            \"max_tokens\": 1000
        }" | \
        jq -r '.choices[0].message.content' 2>/dev/null || echo "OpenAI API call failed"
else
    echo "OPENAI_API_KEY not found in rEngine/.env"
fi
