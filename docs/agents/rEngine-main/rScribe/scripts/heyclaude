#!/bin/bash

# Quick AI consultation script for Claude
# Usage: ./heyclaude "your question"

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Load environment variables for API keys
if [ -f "$PROJECT_ROOT/rEngine/.env" ]; then
    source "$PROJECT_ROOT/rEngine/.env"
fi

QUESTION="$1"
if [ -z "$QUESTION" ]; then
    echo "Usage: $0 'your question'"
    exit 1
fi

# Add context about current project state
CONTEXT="Project: StackTrackr - Memory System Assessment
Current Status: Memory Scribe with real-time console monitoring active
Recent Changes: Implemented comprehensive memory monitoring with 15-min health checks
Question: $QUESTION"

# Call Claude API
if [ -n "$ANTHROPIC_API_KEY" ]; then
    curl -s -X POST \
        "https://api.anthropic.com/v1/messages" \
        -H "Content-Type: application/json" \
        -H "x-api-key: $ANTHROPIC_API_KEY" \
        -H "anthropic-version: 2023-06-01" \
        -d "{
            \"model\": \"claude-3-5-sonnet-20241022\",
            \"max_tokens\": 1000,
            \"messages\": [
                {\"role\": \"user\", \"content\": \"$CONTEXT\"}
            ]
        }" | \
        jq -r '.content[0].text' 2>/dev/null || echo "Claude API call failed"
else
    echo "ANTHROPIC_API_KEY not found in rEngine/.env"
fi
