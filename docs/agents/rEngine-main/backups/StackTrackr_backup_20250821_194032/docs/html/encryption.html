<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackrTrackr Encryption System - StackTrackr Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .header .meta {
            font-size: 0.9em;
            opacity: 0.7;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e4e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 8px 16px;
            background: #007acc;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .content {
            padding: 40px;
            max-width: none;
        }

        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            color: #2c3e50;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .content h1 { font-size: 2.2em; border-bottom: 3px solid #007acc; padding-bottom: 10px; }
        .content h2 { font-size: 1.8em; color: #007acc; }
        .content h3 { font-size: 1.4em; color: #495057; }
        .content h4 { font-size: 1.2em; color: #6c757d; }

        .content p {
            margin-bottom: 16px;
            line-height: 1.7;
            color: #444;
        }

        .content ul, .content ol {
            margin-bottom: 16px;
            padding-left: 25px;
        }

        .content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .content blockquote {
            border-left: 4px solid #007acc;
            background: #f8f9fa;
            margin: 20px 0;
            padding: 15px 20px;
            border-radius: 0 6px 6px 0;
        }

        .content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        .content pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .content pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .content th, .content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e1e4e8;
        }

        .content th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .content tr:hover {
            background: #f8f9fa;
        }

        .content a {
            color: #007acc;
            text-decoration: none;
            font-weight: 500;
        }

        .content a:hover {
            color: #0056b3;
            text-decoration: underline;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px 30px;
            border-top: 1px solid #e1e4e8;
            text-align: center;
            color: #6c757d;
            font-size: 0.9em;
        }

        .doc-meta {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #007acc;
        }

        .doc-meta h3 {
            color: #007acc;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .meta-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }

        .meta-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .meta-value {
            color: #6c757d;
            font-size: 0.9em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .content { padding: 20px; }
            .header { padding: 20px; }
            .nav-bar { padding: 15px 20px; }
            .nav-links { justify-content: center; }
            .header .meta { flex-direction: column; gap: 10px; }
        }

        /* Category-specific colors */
        .color-vision { --primary: #9c27b0; --secondary: #7b1fa2; }
        .color-roadmap { --primary: #007acc; --secondary: #0056b3; }
        .color-engine { --primary: #2c3e50; --secondary: #34495e; }
        .color-agent { --primary: #28a745; --secondary: #198754; }
        .color-brain { --primary: #6f42c1; --secondary: #495057; }
        .color-docker { --primary: #0db7ed; --secondary: #086dd7; }
        .color-mobile { --primary: #fd7e14; --secondary: #dc3545; }
        .color-protocol { --primary: #20c997; --secondary: #198754; }
        .color-scribe { --primary: #17a2b8; --secondary: #138496; }
        .color-groq { --primary: #ffc107; --secondary: #e0a800; }
        .color-task { --primary: #dc3545; --secondary: #c82333; }
        .color-cleanup { --primary: #6c757d; --secondary: #5a6268; }
        .color-quickstart { --primary: #28a745; --secondary: #198754; }
        .color-patch { --primary: #ff6b35; --secondary: #e55a32; }
        .color-rengine { --primary: #8b5cf6; --secondary: #7c3aed; }
        .color-default { --primary: #495057; --secondary: #6c757d; }
    </style>
</head>
<body class="color-default">
    <div class="container">
        <header class="header">
            <div class="header-icon">üìÑ</div>
            <h1>StackrTrackr Encryption System</h1>
            <div class="subtitle">Documentation</div>
            <div class="meta">
                <span>üìÅ encryption.md</span>
                <span>üìÖ 2025-08-18</span>
                <span>üìä 6KB</span>
            </div>
        </header>

        <nav class="nav-bar">
            <div class="nav-links">
                <a href="../index.html" class="nav-link">üè† Documentation Home</a>
                <a href="../developmentstatus.html" class="nav-link">üìä Development Status</a>
                <a href="../generated/js/encryption.md" class="nav-link">üìù View Source MD</a>
                <a href="../json/encryption.json" class="nav-link">üîß JSON Data</a>
            </div>
        </nav>

        <main class="content">
            <h1 id="stackrtrackr-encryption-system">StackrTrackr Encryption System</h1>
<p>This script provides a robust encryption system for securing sensitive StackrTrackr application data within the browser&#39;s local storage. It uses AES-GCM encryption with PBKDF2 key derivation to protect API keys, inventory data, settings, and other critical information. The system is designed to be backward compatible with existing unencrypted installations, allowing for a smooth transition to encrypted storage.  A user interface is provided to manage the encryption setup, unlock process, password changes, and data migration.</p>
<h2 id="how-to-use">How to Use</h2>
<p>This script is designed to be used within a web browser environment.  It does not run from the command line.  Include <code>encryption.js</code> in your HTML file using a <code>&lt;script&gt;</code> tag:</p>
<pre><code class="language-html"><pre><code class="language-html"><script src="encryption.js"></script></code></pre>
</code></pre>
<p>The script creates a global <code>encryptionManager</code> instance and a <code>masterPasswordUI</code> instance. Interact with the encryption functionality through the <code>encryptionManager</code> object. Example:</p>
<pre><code class="language-javascript"><pre><code class="language-javascript">// Check if a master password is set
const hasMasterPassword = encryptionManager.hasMasterPassword();

// Setup a master password
encryptionManager.setupMasterPassword('MyStrongPassword').then(() => {
  // ... handle setup success/failure ...
});

// Unlock encryption
encryptionManager.unlockWithPassword('MyStrongPassword').then(() => {
  // ... proceed with encrypted operations ...
});

// Store encrypted data
encryptionManager.secureStore('stackrtrackr.inventory', myInventoryData).then(() => {
  // ... data is now securely stored ...
});


// Retrieve decrypted data
encryptionManager.secureRetrieve('stackrtrackr.inventory').then((inventoryData) => {
  // ... use the decrypted inventory data ...
});
</code></pre>
</code></pre>
<p>The <code>MasterPasswordUI</code> class handles user interface interactions related to setting up, unlocking, and managing the encryption. You&#39;ll need corresponding HTML elements with the IDs referenced in the <code>MasterPasswordUI</code> code (e.g., <code>setupEncryptionBtn</code>, <code>unlockEncryptionBtn</code>, <code>masterPassword</code> input field, etc.) to enable the UI functionality.  See the <code>MasterPasswordUI</code> class documentation for specific element IDs.</p>
<h2 id="core-logic-breakdown">Core Logic Breakdown</h2>
<p>The script defines two main classes:</p>
<p><strong>1. <code>StackrTrackrEncryption</code>:</strong></p>
<ul>
<li><strong><code>constructor()</code>:</strong> Initializes the encryption system, checks for an existing master password, and sets up protected keys.</li>
<li><code>init()</code>:  Checks if a master password exists and sets up protected keys array.</li>
<li><code>hasMasterPassword()</code> : Returns whether encryption is setup (i.e., if there&#39;s a salt key stored).</li>
<li><code>isUnlocked()</code>: Returns whether the user has unlocked the encryption by providing the correct master password.</li>
<li><code>generateSalt()</code>: Generates a random cryptographic salt.</li>
<li><code>deriveKey(password, salt)</code>: Derives an encryption key from the master password and salt using PBKDF2.</li>
<li><code>setupMasterPassword(password)</code>: Sets up the master password, generates a salt, derives the key, and stores encrypted verification data.</li>
<li><code>unlockWithPassword(password)</code>: Unlocks the system by verifying the provided password against the stored verification data.</li>
<li><code>changeMasterPassword(oldPassword, newPassword)</code>: Changes the master password and re-encrypts all existing data with the new key.</li>
<li><code>encryptData(data, key)</code>: Encrypts data using AES-GCM.</li>
<li><code>decryptData(encryptedData, key)</code>: Decrypts data using AES-GCM.</li>
<li><code>storeEncrypted(key, data)</code>: Stores encrypted data in local storage.</li>
<li><code>retrieveDecrypted(key)</code>: Retrieves and decrypts data from local storage.</li>
<li><code>lock()</code>: Clears the master key from memory, effectively locking the system.</li>
<li><code>setDebugMode(enabled)</code>: Enables/disables debug logging.</li>
<li><code>migrateExistingData()</code>: Migrates existing unencrypted data to encrypted storage. (Deprecated, use <code>migrateToEncrypted()</code>)</li>
<li><code>emergencyDecryptAll()</code>: Decrypts all data for debugging purposes (requires debug mode to be enabled).</li>
<li><code>secureStore(key, data)</code>: Stores data securely, encrypting if unlocked, storing plain if not.</li>
<li><code>secureRetrieve(key, defaultValue)</code>: Retrieves data, decrypting if encrypted, retrieving plain if not.</li>
<li><code>migrateToEncrypted()</code>: Migrates unencrypted data identified by <code>protectedKeys</code> to encrypted storage.</li>
<li><code>hasEncryptedData(key)</code>: Checks if a specific key has encrypted data associated with it.</li>
<li><code>hasUnencryptedData(key)</code>: Checks if a specific key has UNencrypted data associated with it.</li>
<li><code>getDataStatus()</code>:  Returns a structured object indicating which keys have encrypted data, unencrypted data, or no data.</li>
<li><code>emergencyDisableEncryption(password)</code>: Decrypts all encrypted data and removes encryption setup.</li>
</ul>
<p><strong>2. <code>MasterPasswordUI</code>:</strong></p>
<ul>
<li>Manages the user interface elements for interacting with the encryption system.</li>
<li>Handles events for setup, unlock, lock, password change, data migration, and emergency disable.</li>
<li>Updates the UI based on the encryption status.</li>
</ul>
<h2 id="configuration--dependencies">Configuration &amp; Dependencies</h2>
<p>This script depends on the Web Crypto API (<code>crypto.subtle</code>), which is a built-in part of modern web browsers. It does not have any external npm package dependencies.  The script uses <code>localStorage</code> for persistent storage of the encrypted data and related encryption information (salt, verification data).</p>
<p>The <code>protectedKeys</code> array within the <code>StackrTrackrEncryption</code> class defines which keys in local storage should be encrypted.  This array serves as the configuration for what data needs protection.</p>
<h2 id="machine-readable-summary">Machine-Readable Summary</h2>
<pre><code class="language-json"><pre><code class="language-json">{
  "scriptName": "encryption.js",
  "purpose": "Provides client-side encryption for sensitive StackrTrackr application data in local storage using AES-GCM.",
  "inputs": {
    "arguments": [],
    "dependencies": [
      "Web Crypto API (crypto.subtle)",
      "Browser Local Storage"
    ],
    "userInputs": [
      "Master Password",
      "Data to Encrypt/Decrypt"
    ]
  },
  "outputs": {
    "localStorage": "Encrypted data stored in local storage prefixed with 'stackrtrackr_encrypted_'",
    "console": "Logs and status messages (especially when debug mode is enabled)"
  }
}</code></pre>
</code></pre>

        </main>

        <footer class="footer">
            <p>Generated from <strong>encryption.md</strong> ‚Ä¢ StackTrackr Documentation System ‚Ä¢ Last updated: 2025-08-18</p>
        </footer>
    </div>
</body>
</html>