<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† rAgents Memory Scribe Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-running { background: #4ade80; }
        .status-stopped { background: #ef4444; }
        .status-starting { background: #f59e0b; animation: pulse 2s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #666;
        }

        .metric-value {
            font-weight: 600;
            color: #333;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }

        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }

        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }

        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .logs-container {
            background: #1f2937;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            color: #f9fafb;
            font-family: 'Monaco', 'Menlo', monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .logs-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
            color: #d1d5db;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-left: 3px solid transparent;
            padding-left: 10px;
        }

        .log-info { border-left-color: #3b82f6; }
        .log-success { border-left-color: #10b981; }
        .log-warning { border-left-color: #f59e0b; }
        .log-error { border-left-color: #ef4444; }

        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .search-results {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .search-result {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .search-result:hover {
            background: #f8fafc;
        }

        .search-result:last-child {
            border-bottom: none;
        }

        .result-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .result-snippet {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        .result-meta {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success { border-left: 4px solid #10b981; }
        .toast-error { border-left: 4px solid #ef4444; }
        .toast-info { border-left: 4px solid #3b82f6; }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .config-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .config-label {
            font-weight: 500;
            color: #666;
            font-size: 14px;
        }

        .config-input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .config-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .flag-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .flag-input {
            flex: 1;
            min-width: 120px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
        }

        @media (max-width: 768px) {
            .dashboard {
                padding: 10px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üß† rAgents Memory Scribe Dashboard</h1>
            <p>AI-Powered Context Management & Control Center</p>
        </div>

        <div class="grid">
            <!-- System Status Card -->
            <div class="card">
                <h3>
                    <span class="status-indicator" id="system-status"></span>
                    System Status
                </h3>
                <div class="metric">
                    <span class="metric-label">Memory Scribe</span>
                    <span class="metric-value" id="scribe-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Protection System</span>
                    <span class="metric-value" id="protection-status">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Uptime</span>
                    <span class="metric-value" id="uptime">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Memory Usage</span>
                    <span class="metric-value" id="memory-usage">--</span>
                </div>

                <div class="controls">
                    <button class="btn btn-success" onclick="startMemoryScribe()">
                        ‚ñ∂Ô∏è Start
                    </button>
                    <button class="btn btn-warning" onclick="restartMemoryScribe()">
                        üîÑ Restart
                    </button>
                    <button class="btn btn-danger" onclick="stopMemoryScribe()">
                        ‚èπÔ∏è Stop
                    </button>
                </div>
            </div>

            <!-- Data Statistics Card -->
            <div class="card">
                <h3>üìä Memory Statistics</h3>
                <div class="metric">
                    <span class="metric-label">Conversations</span>
                    <span class="metric-value" id="conversations-count">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Knowledge Items</span>
                    <span class="metric-value" id="knowledge-count">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Context Patterns</span>
                    <span class="metric-value" id="patterns-count">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Backups Created</span>
                    <span class="metric-value" id="backups-count">--</span>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="analyzeContext()">
                        üîç Analyze Context
                    </button>
                    <button class="btn btn-warning" onclick="cleanupMemory()">
                        üßπ Cleanup
                    </button>
                </div>
            </div>

            <!-- AI Providers Card -->
            <div class="card">
                <h3>ü§ñ AI Providers</h3>
                <div id="ai-providers-list">
                    <div class="metric">
                        <span class="metric-label">Loading...</span>
                        <span class="metric-value">--</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="refreshAIProviders()">
                        üîÑ Refresh Providers
                    </button>
                    <button class="btn btn-success" onclick="testAIProvider()">
                        üß™ Test Selected
                    </button>
                    <button class="btn btn-warning" onclick="showAIConfig()">
                        ‚öôÔ∏è Configure APIs
                    </button>
                </div>
            </div>

            <!-- Ollama Models Card -->
            <div class="card">
                <h3>ÔøΩ Ollama Models</h3>
                <div id="models-list">
                    <div class="metric">
                        <span class="metric-label">Connection</span>
                        <span class="metric-value" id="ollama-status">Checking...</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="refreshModels()">
                        üîÑ Refresh Models
                    </button>
                    <button class="btn btn-success" onclick="testOllama()">
                        üß™ Test Connection
                    </button>
                </div>
            </div>

            <!-- Configuration Card -->
            <div class="card">
                <h3>‚öôÔ∏è Configuration</h3>
                <div class="config-grid">
                    <div class="config-item">
                        <label class="config-label">Retention Days</label>
                        <input type="number" class="config-input" id="retention-days" value="90">
                    </div>
                    <div class="config-item">
                        <label class="config-label">Forever Mode</label>
                        <select class="config-input" id="forever-mode">
                            <option value="false">Disabled</option>
                            <option value="true">Enabled</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label class="config-label">Auto Cleanup</label>
                        <select class="config-input" id="auto-cleanup">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="saveConfig()">
                        üíæ Save Config
                    </button>
                    <button class="btn btn-success" onclick="enableForeverMode()">
                        ‚ôæÔ∏è Enable Forever
                    </button>
                </div>
            </div>
        </div>

        <!-- Context Search -->
        <div class="card">
            <h3>üîç Context Search</h3>
            <input type="text" class="search-box" id="search-input" placeholder="Search your conversation history, knowledge base, and patterns...">
            <div id="search-results"></div>
        </div>

        <!-- Memory Flagging -->
        <div class="card">
            <h3>üè∑Ô∏è Flag Management</h3>
            <div class="flag-controls">
                <select class="flag-input" id="flag-type">
                    <option value="conversation">Conversation</option>
                    <option value="knowledge">Knowledge</option>
                    <option value="pattern">Pattern</option>
                </select>
                <input type="text" class="flag-input" id="flag-id" placeholder="Item ID">
                <select class="flag-input" id="flag-action">
                    <option value="preserve">Preserve</option>
                    <option value="ignore">Ignore</option>
                    <option value="prioritize">Prioritize</option>
                    <option value="archive_now">Archive Now</option>
                </select>
                <input type="text" class="flag-input" id="flag-reason" placeholder="Reason (optional)">
                <button class="btn btn-primary" onclick="flagItem()">
                    üè∑Ô∏è Flag Item
                </button>
            </div>
        </div>

        <!-- System Logs -->
        <div class="logs-container">
            <div class="logs-header">
                <h3>üìù System Logs</h3>
                <div class="controls">
                    <button class="btn btn-primary" onclick="refreshLogs()">
                        üîÑ Refresh
                    </button>
                    <button class="btn btn-warning" onclick="clearLogs()">
                        üóëÔ∏è Clear
                    </button>
                </div>
            </div>
            <div id="logs-content">
                <div class="log-entry log-info">Starting dashboard...</div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast">
        <div id="toast-message"></div>
    </div>

    <script>
        // Dashboard state
        let systemStatus = {
            scribe: false,
            protection: false,
            uptime: 0,
            memory: 0
        };

        let refreshInterval;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            log('Dashboard initialized', 'info');
            refreshStatus();
            setupAutoRefresh();
            setupSearch();
        });

        // Auto-refresh every 5 seconds
        function setupAutoRefresh() {
            refreshInterval = setInterval(refreshStatus, 5000);
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            let searchTimeout;

            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(this.value);
                }, 300);
            });
        }

        // API calls to backend
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`/api/${endpoint}`, options);
                return await response.json();
            } catch (error) {
                log(`API call failed: ${error.message}`, 'error');
                return { error: error.message };
            }
        }

        // Refresh system status
        async function refreshStatus() {
            try {
                const status = await apiCall('status');
                updateStatusDisplay(status);
                
                const stats = await apiCall('stats');
                updateStatsDisplay(stats);
                
                const models = await apiCall('models');
                updateModelsDisplay(models);
                
                const aiProviders = await apiCall('ai-providers');
                updateAIProvidersDisplay(aiProviders);
                
            } catch (error) {
                log(`Failed to refresh status: ${error.message}`, 'error');
            }
        }

        // Update status display
        function updateStatusDisplay(status) {
            const statusIndicator = document.getElementById('system-status');
            const scribeStatus = document.getElementById('scribe-status');
            const protectionStatus = document.getElementById('protection-status');
            const uptime = document.getElementById('uptime');
            const memoryUsage = document.getElementById('memory-usage');

            if (status.scribe) {
                statusIndicator.className = 'status-indicator status-running';
                scribeStatus.textContent = 'Running';
            } else {
                statusIndicator.className = 'status-indicator status-stopped';
                scribeStatus.textContent = 'Stopped';
            }

            protectionStatus.textContent = status.protection ? 'Active' : 'Inactive';
            uptime.textContent = formatUptime(status.uptime || 0);
            memoryUsage.textContent = `${Math.round(status.memory || 0)}MB`;
        }

        // Update statistics display
        function updateStatsDisplay(stats) {
            document.getElementById('conversations-count').textContent = stats.conversations || 0;
            document.getElementById('knowledge-count').textContent = stats.knowledge || 0;
            document.getElementById('patterns-count').textContent = stats.patterns || 0;
            document.getElementById('backups-count').textContent = stats.backups || 0;
        }

        // Update models display
        function updateModelsDisplay(models) {
            const modelsList = document.getElementById('models-list');
            const ollamaStatus = document.getElementById('ollama-status');

            if (models.error) {
                ollamaStatus.textContent = 'Disconnected';
                return;
            }

            ollamaStatus.textContent = 'Connected';
            
            // Clear existing models except status
            const existingModels = modelsList.querySelectorAll('.metric:not(:first-child)');
            existingModels.forEach(model => model.remove());

            if (models.models) {
                models.models.slice(0, 5).forEach(model => {
                    const modelDiv = document.createElement('div');
                    modelDiv.className = 'metric';
                    modelDiv.innerHTML = `
                        <span class="metric-label">${model.name}</span>
                        <span class="metric-value">${Math.round(model.size / 1024 / 1024)}MB</span>
                    `;
                    modelsList.appendChild(modelDiv);
                });
            }
        }

        // Control functions
        async function startMemoryScribe() {
            log('Starting Memory Scribe...', 'info');
            const result = await apiCall('start', 'POST');
            
            if (result.success) {
                showToast('Memory Scribe started successfully', 'success');
                log('Memory Scribe started', 'success');
            } else {
                showToast('Failed to start Memory Scribe', 'error');
                log(`Start failed: ${result.error}`, 'error');
            }
            
            setTimeout(refreshStatus, 1000);
        }

        async function stopMemoryScribe() {
            log('Stopping Memory Scribe...', 'info');
            const result = await apiCall('stop', 'POST');
            
            if (result.success) {
                showToast('Memory Scribe stopped', 'success');
                log('Memory Scribe stopped', 'success');
            } else {
                showToast('Failed to stop Memory Scribe', 'error');
                log(`Stop failed: ${result.error}`, 'error');
            }
            
            setTimeout(refreshStatus, 1000);
        }

        async function restartMemoryScribe() {
            log('Restarting Memory Scribe...', 'info');
            await stopMemoryScribe();
            setTimeout(startMemoryScribe, 2000);
        }

        async function analyzeContext() {
            log('Analyzing context health...', 'info');
            const result = await apiCall('analyze', 'POST');
            
            if (result.success) {
                showToast('Context analysis complete', 'success');
                log('Context analysis completed', 'success');
            } else {
                showToast('Analysis failed', 'error');
                log(`Analysis failed: ${result.error}`, 'error');
            }
        }

        async function cleanupMemory() {
            if (!confirm('Are you sure you want to cleanup old memory? This will archive old items.')) {
                return;
            }
            
            log('Starting memory cleanup...', 'info');
            const result = await apiCall('cleanup', 'POST');
            
            if (result.success) {
                showToast('Memory cleanup complete', 'success');
                log(`Cleanup complete: ${result.archived} items archived`, 'success');
            } else {
                showToast('Cleanup failed', 'error');
                log(`Cleanup failed: ${result.error}`, 'error');
            }
        }

        async function refreshModels() {
            log('Refreshing Ollama models...', 'info');
            const models = await apiCall('models');
            updateModelsDisplay(models);
            
            if (!models.error) {
                showToast('Models refreshed', 'success');
            }
        }

        async function testOllama() {
            log('Testing Ollama connection...', 'info');
            const result = await apiCall('test-ollama', 'POST');
            
            if (result.success) {
                showToast('Ollama connection successful', 'success');
                log('Ollama test successful', 'success');
            } else {
                showToast('Ollama connection failed', 'error');
                log(`Ollama test failed: ${result.error}`, 'error');
            }
        }

        async function saveConfig() {
            const config = {
                retentionDays: document.getElementById('retention-days').value,
                foreverMode: document.getElementById('forever-mode').value === 'true',
                autoCleanup: document.getElementById('auto-cleanup').value === 'true'
            };

            log('Saving configuration...', 'info');
            const result = await apiCall('config', 'POST', config);
            
            if (result.success) {
                showToast('Configuration saved', 'success');
                log('Configuration updated', 'success');
            } else {
                showToast('Failed to save configuration', 'error');
                log(`Config save failed: ${result.error}`, 'error');
            }
        }

        async function enableForeverMode() {
            document.getElementById('forever-mode').value = 'true';
            await saveConfig();
            showToast('Forever mode enabled - context will never be deleted', 'success');
        }

        // AI Provider Management Functions
        async function refreshAIProviders() {
            log('Refreshing AI providers...', 'info');
            const aiProviders = await apiCall('ai-providers');
            updateAIProvidersDisplay(aiProviders);
            
            if (!aiProviders.error) {
                showToast('AI providers refreshed', 'success');
            }
        }

        async function testAIProvider() {
            const selectedProvider = document.getElementById('selected-provider')?.value;
            if (!selectedProvider) {
                showToast('Please select a provider to test', 'error');
                return;
            }

            log(`Testing ${selectedProvider} provider...`, 'info');
            const result = await apiCall('ai-test', 'POST', { 
                provider: selectedProvider,
                prompt: 'Hello! Please respond with a brief greeting to confirm you are working.'
            });
            
            if (result.success) {
                showToast(`${selectedProvider} test successful`, 'success');
                log(`Test response: ${result.result.response.substring(0, 100)}...`, 'success');
            } else {
                showToast(`${selectedProvider} test failed`, 'error');
                log(`Test failed: ${result.error}`, 'error');
            }
        }

        async function showAIConfig() {
            const apiKeys = prompt('Enter API keys in JSON format:\\n{\\n  "gemini": "your-gemini-key",\\n  "openai": "your-openai-key",\\n  "qwen": "your-qwen-key"\\n}');
            
            if (apiKeys) {
                try {
                    const parsedKeys = JSON.parse(apiKeys);
                    const result = await apiCall('ai-config', 'POST', { apiKeys: parsedKeys });
                    
                    if (result.success) {
                        showToast('API configuration updated', 'success');
                        refreshAIProviders();
                    } else {
                        showToast('Failed to update configuration', 'error');
                    }
                } catch (error) {
                    showToast('Invalid JSON format', 'error');
                }
            }
        }

        function updateAIProvidersDisplay(aiProviders) {
            const providersList = document.getElementById('ai-providers-list');
            
            if (aiProviders.error || !aiProviders.providers) {
                providersList.innerHTML = '<div class="metric"><span class="metric-label">Error</span><span class="metric-value">Failed to load</span></div>';
                return;
            }

            // Clear existing content
            providersList.innerHTML = '';

            // Add provider selector if we have providers
            if (aiProviders.providers.length > 0) {
                const selectorDiv = document.createElement('div');
                selectorDiv.className = 'metric';
                selectorDiv.innerHTML = 
                    '<span class="metric-label">Active Provider</span>' +
                    '<select id="selected-provider" class="config-input">' +
                        aiProviders.providers.map(provider => 
                            '<option value="' + provider.key + '"' + (provider.available ? '' : ' disabled') + '>' +
                                provider.name + ' ' + (provider.available ? '‚úÖ' : '‚ùå') +
                            '</option>'
                        ).join('') +
                    '</select>';
                providersList.appendChild(selectorDiv);

                // Add provider details
                aiProviders.providers.forEach(provider => {
                    const providerDiv = document.createElement('div');
                    providerDiv.className = 'metric';
                    const status = provider.available ? '‚úÖ' : '‚ùå';
                    const modelCount = provider.available ? ' (' + provider.models + ' models)' : '';
                    providerDiv.innerHTML = 
                        '<span class="metric-label">' + provider.name + '</span>' +
                        '<span class="metric-value">' + status + ' ' + provider.cost + modelCount + '</span>';
                    providersList.appendChild(providerDiv);
                });
            } else {
                providersList.innerHTML = '<div class="metric"><span class="metric-label">No Providers</span><span class="metric-value">Available</span></div>';
            }
        }

        async function performSearch(query) {
            if (query.length < 3) {
                document.getElementById('search-results').innerHTML = '';
                return;
            }

            log(`Searching for: ${query}`, 'info');
            const results = await apiCall(`search?q=${encodeURIComponent(query)}`);
            
            const resultsDiv = document.getElementById('search-results');
            
            if (results.error || !results.results || results.results.length === 0) {
                resultsDiv.innerHTML = '<div class="search-results"><p>No results found</p></div>';
                return;
            }

            const resultsHtml = results.results.map(result => `
                <div class="search-result" onclick="viewResult('${result.id}')">
                    <div class="result-title">${result.title}</div>
                    <div class="result-snippet">${result.snippet}</div>
                    <div class="result-meta">${result.source} ‚Ä¢ ${result.timestamp}</div>
                </div>
            `).join('');

            resultsDiv.innerHTML = `<div class="search-results">${resultsHtml}</div>`;
        }

        async function flagItem() {
            const type = document.getElementById('flag-type').value;
            const id = document.getElementById('flag-id').value;
            const action = document.getElementById('flag-action').value;
            const reason = document.getElementById('flag-reason').value;

            if (!id) {
                showToast('Please enter an item ID', 'error');
                return;
            }

            log(`Flagging ${type} ${id} as ${action}`, 'info');
            const result = await apiCall('flag', 'POST', { type, id, action, reason });
            
            if (result.success) {
                showToast(`Item flagged as ${action}`, 'success');
                log(`Flagged ${type} ${id} as ${action}`, 'success');
                
                // Clear form
                document.getElementById('flag-id').value = '';
                document.getElementById('flag-reason').value = '';
            } else {
                showToast('Failed to flag item', 'error');
                log(`Flag failed: ${result.error}`, 'error');
            }
        }

        function viewResult(id) {
            log(`Viewing result: ${id}`, 'info');
            // This could open a modal or navigate to a detail view
            showToast(`Viewing item ${id}`, 'info');
        }

        function refreshLogs() {
            log('Logs refreshed', 'info');
        }

        function clearLogs() {
            document.getElementById('logs-content').innerHTML = '';
            log('Logs cleared', 'info');
        }

        // Utility functions
        function log(message, type = 'info') {
            const logsContent = document.getElementById('logs-content');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logsContent.appendChild(logEntry);
            logsContent.scrollTop = logsContent.scrollHeight;
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toast.className = `toast toast-${type}`;
            toastMessage.textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m`;
            } else {
                return `${seconds}s`;
            }
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>
