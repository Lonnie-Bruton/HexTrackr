{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://stacktrackr.dev/schemas/memory-snapshot.json",
  "title": "StackTrackr Memory Snapshot",
  "description": "Central memory snapshot for multi-agent collaboration",
  "type": "object",
  "required": ["metadata", "entities", "decisions", "tasks"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["version", "created", "last_updated", "schema_version"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
          "description": "Semantic version of the snapshot format"
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp when snapshot was created"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp of last update"
        },
        "schema_version": {
          "type": "string",
          "description": "Schema version for validation"
        },
        "last_agent": {
          "type": "string",
          "description": "ID of last agent to modify snapshot"
        },
        "last_event": {
          "type": "string",
          "description": "ID of last event that modified snapshot"
        },
        "initialized_from": {
          "type": "string",
          "description": "Source of initial data"
        }
      }
    },
    "entities": {
      "type": "object",
      "description": "Named entities and relationships",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["person", "organization", "technology", "concept", "file", "bug", "feature"]
          },
          "description": {
            "type": "string"
          },
          "attributes": {
            "type": "object"
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "target": {"type": "string"},
                "type": {"type": "string"},
                "strength": {"type": "number", "minimum": 0, "maximum": 1}
              }
            }
          },
          "created": {"type": "string", "format": "date-time"},
          "updated": {"type": "string", "format": "date-time"},
          "agent_id": {"type": "string"}
        }
      }
    },
    "decisions": {
      "type": "object",
      "description": "Strategic decisions and their rationale",
      "additionalProperties": {
        "type": "object",
        "required": ["title", "status", "rationale"],
        "properties": {
          "title": {"type": "string"},
          "description": {"type": "string"},
          "status": {
            "type": "string",
            "enum": ["proposed", "approved", "implemented", "rejected", "superseded"]
          },
          "rationale": {"type": "string"},
          "alternatives": {
            "type": "array",
            "items": {"type": "string"}
          },
          "impact": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"]
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "created": {"type": "string", "format": "date-time"},
          "updated": {"type": "string", "format": "date-time"},
          "agent_id": {"type": "string"}
        }
      }
    },
    "tasks": {
      "type": "object",
      "description": "Active tasks and work items",
      "additionalProperties": {
        "type": "object",
        "required": ["title", "status", "priority"],
        "properties": {
          "title": {"type": "string"},
          "description": {"type": "string"},
          "status": {
            "type": "string",
            "enum": ["backlog", "todo", "in_progress", "review", "done", "blocked", "cancelled"]
          },
          "priority": {
            "type": "string",
            "enum": ["low", "medium", "high", "urgent"]
          },
          "assignee": {"type": "string"},
          "dependencies": {
            "type": "array",
            "items": {"type": "string"}
          },
          "estimate": {"type": "string"},
          "labels": {
            "type": "array",
            "items": {"type": "string"}
          },
          "created": {"type": "string", "format": "date-time"},
          "updated": {"type": "string", "format": "date-time"},
          "agent_id": {"type": "string"}
        }
      }
    },
    "bugs": {
      "type": "object",
      "description": "Bug reports and fixes",
      "additionalProperties": {
        "type": "object",
        "required": ["title", "severity", "status"],
        "properties": {
          "title": {"type": "string"},
          "description": {"type": "string"},
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"]
          },
          "status": {
            "type": "string",
            "enum": ["new", "confirmed", "in_progress", "fixed", "wontfix", "duplicate"]
          },
          "steps_to_reproduce": {
            "type": "array",
            "items": {"type": "string"}
          },
          "expected_behavior": {"type": "string"},
          "actual_behavior": {"type": "string"},
          "affected_files": {
            "type": "array",
            "items": {"type": "string"}
          },
          "fix_description": {"type": "string"},
          "created": {"type": "string", "format": "date-time"},
          "updated": {"type": "string", "format": "date-time"},
          "agent_id": {"type": "string"}
        }
      }
    },
    "roadmap": {
      "type": "object",
      "description": "Product roadmap and feature planning",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "title": {"type": "string"},
          "description": {"type": "string"},
          "status": {
            "type": "string",
            "enum": ["planned", "in_progress", "completed", "cancelled", "on_hold"]
          },
          "milestone": {"type": "string"},
          "target_date": {"type": "string", "format": "date"},
          "dependencies": {
            "type": "array",
            "items": {"type": "string"}
          },
          "effort_estimate": {"type": "string"},
          "business_value": {
            "type": "string",
            "enum": ["low", "medium", "high"]
          },
          "created": {"type": "string", "format": "date-time"},
          "updated": {"type": "string", "format": "date-time"},
          "agent_id": {"type": "string"}
        }
      }
    },
    "patterns": {
      "type": "object",
      "description": "Code patterns and architectural decisions",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"},
          "category": {
            "type": "string",
            "enum": ["architecture", "ui", "api", "data", "security", "performance"]
          },
          "pattern": {"type": "string"},
          "antipattern": {"type": "string"},
          "examples": {
            "type": "array",
            "items": {"type": "string"}
          },
          "benefits": {
            "type": "array",
            "items": {"type": "string"}
          },
          "drawbacks": {
            "type": "array",
            "items": {"type": "string"}
          },
          "created": {"type": "string", "format": "date-time"},
          "updated": {"type": "string", "format": "date-time"},
          "agent_id": {"type": "string"}
        }
      }
    },
    "agents": {
      "type": "object",
      "description": "Agent-specific memory and context",
      "additionalProperties": {
        "type": "object",
        "description": "Memory for a specific agent",
        "properties": {
          "identity": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "role": {"type": "string"},
              "expertise": {
                "type": "array",
                "items": {"type": "string"}
              },
              "preferences": {"type": "object"}
            }
          },
          "context": {
            "type": "object",
            "properties": {
              "recent_actions": {
                "type": "array",
                "items": {"type": "string"}
              },
              "current_focus": {"type": "string"},
              "active_sessions": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          },
          "knowledge": {
            "type": "object",
            "description": "Agent's accumulated knowledge"
          },
          "last_active": {"type": "string", "format": "date-time"},
          "session_count": {"type": "integer", "minimum": 0}
        }
      }
    }
  },
  "additionalProperties": false
}
