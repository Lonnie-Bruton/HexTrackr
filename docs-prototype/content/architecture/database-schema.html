<!-- Section Template for Documentation Portal -->
<div class="documentation-section">
    <h1>Database Schema</h1>
<p>Complete database schema documentation for HexTrackr&#39;s SQLite database architecture.</p>
<h2>Overview</h2>
<p><strong>Database:</strong> SQLite3 located at <code>data/hextrackr.db</code><br><strong>Initialization:</strong> <code>scripts/init-database.js</code><br><strong>Architecture:</strong> Time-series vulnerability tracking with normalized data structure</p>
<h2>Database Statistics</h2>
<ul>
<li><strong>Main Tables:</strong> 4</li>
<li><strong>Indexes:</strong> 5  </li>
<li><strong>Foreign Keys:</strong> 2</li>
<li><strong>Junction Tables:</strong> 1</li>
</ul>
<h2>Schema Relationships</h2>
<h3>tickets</h3>
<p>Main table for security ticket management and tracking.</p>
<div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">[object Object]</thead>
                    <tbody>undefined</tbody>
                </table>
            </div><h3>vulnerability_imports</h3>
<p>Tracks CSV import operations and metadata for vulnerability data.</p>
<div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">[object Object]</thead>
                    <tbody>undefined</tbody>
                </table>
            </div><h3>vulnerabilities</h3>
<p>Individual vulnerability records from scanned systems.</p>
<div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">[object Object]</thead>
                    <tbody>undefined</tbody>
                </table>
            </div><h3>ticket_vulnerabilities</h3>
<p>Junction table linking tickets to vulnerabilities for relationship tracking.</p>
<div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">[object Object]</thead>
                    <tbody>undefined</tbody>
                </table>
            </div><h2>Indexes</h2>
<ol>
<li><strong>idx_vulnerabilities_import_id</strong> - Optimizes import-based queries</li>
<li><strong>idx_vulnerabilities_hostname</strong> - Speeds up hostname searches  </li>
<li><strong>idx_vulnerabilities_cve</strong> - Accelerates CVE lookups</li>
<li><strong>idx_tickets_status</strong> - Improves status-based filtering</li>
<li><strong>idx_ticket_vulnerabilities_ticket</strong> - Junction table optimization</li>
</ol>
<h2>Foreign Key Constraints</h2>
<ol>
<li><p><strong>vulnerabilities.import_id → vulnerability_imports.id</strong></p>
<ul>
<li>Maintains referential integrity for import tracking</li>
<li>Cascade delete removes vulnerabilities when import is deleted</li>
</ul>
</li>
<li><p><strong>ticket_vulnerabilities.ticket_id → tickets.id</strong>  </p>
<ul>
<li>Links vulnerabilities to tickets</li>
<li>Cascade delete removes relationships when ticket is deleted</li>
</ul>
</li>
</ol>
<h2>Data Flow</h2>
<h3>Import Process</h3>
<ol>
<li>CSV files uploaded to <code>uploads/</code> directory</li>
<li>Import metadata recorded in <code>vulnerability_imports</code></li>
<li>Individual records parsed and stored in <code>vulnerabilities</code></li>
<li>UPSERT operations prevent duplicates based on hostname+CVE+import</li>
</ol>
<h3>Ticket Workflow</h3>
<ol>
<li>New tickets created in <code>tickets</code> table</li>
<li>Vulnerabilities linked via <code>ticket_vulnerabilities</code> junction</li>
<li>Status updates tracked with timestamps</li>
<li>Device information stored as JSON arrays</li>
</ol>
<h3>Query Patterns</h3>
<p><strong>Common Queries:</strong></p>
<ul>
<li>Vulnerabilities by severity: <code>SELECT * FROM vulnerabilities WHERE severity = &#39;Critical&#39;</code></li>
<li>Tickets by status: <code>SELECT * FROM tickets WHERE status = &#39;Open&#39;</code></li>
<li>Import history: <code>SELECT * FROM vulnerability_imports ORDER BY import_date DESC</code></li>
<li>Ticket relationships: Join through <code>ticket_vulnerabilities</code> junction table</li>
</ul>
<p><strong>Performance Optimizations:</strong></p>
<ul>
<li>Indexed columns for frequent WHERE clauses</li>
<li>JSON storage for flexible device arrays</li>
<li>Time-series approach for historical tracking</li>
<li>Normalized structure reduces data redundancy</li>
</ul>
<h2>Schema Evolution</h2>
<p>The database schema supports:</p>
<ul>
<li><strong>Backward compatibility</strong> - New columns added with defaults</li>
<li><strong>Migration scripts</strong> - Schema updates through versioned migrations  </li>
<li><strong>Data integrity</strong> - Foreign key constraints and validation</li>
<li><strong>Performance</strong> - Strategic indexing for common access patterns</li>
</ul>
<p>This architecture enables efficient vulnerability tracking while maintaining flexibility for ticket management workflows.</p>

</div>

<!-- Section-specific styling can be added here -->
<style>
    
                .schema-diagram {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 1.5rem;
                    margin: 2rem 0;
                }
                
                .table-box {
                    background: white;
                    border: 2px solid #dee2e6;
                    border-radius: 8px;
                    padding: 1rem;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }
                
                .table-box h4 {
                    background: #007bff;
                    color: white;
                    margin: -1rem -1rem 1rem -1rem;
                    padding: 0.75rem 1rem;
                    border-radius: 6px 6px 0 0;
                    font-weight: 600;
                }
                
                .fields .field {
                    padding: 0.5rem;
                    border-bottom: 1px solid #f1f3f4;
                    font-family: 'Monaco', monospace;
                    font-size: 0.9em;
                }
                
                .field.primary {
                    background: #e3f2fd;
                    font-weight: bold;
                }
                
                .field.foreign {
                    background: #fff3e0;
                    color: #f57c00;
                }
            
</style>
