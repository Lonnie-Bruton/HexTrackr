<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexTrackr - Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="../../styles/shared/base.css" rel="stylesheet">
    <link href="../../styles/shared/header.css" rel="stylesheet">
    <link href="../css/docs-tabler.css" rel="stylesheet">
</head>
<body>
    <div class="page">
        <!-- Shared Header -->
        <div id="headerContainer"></div>
        
        <div class="page-wrapper">
            <div class="page-body">
                <div class="container-xl">
                    <div class="row g-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h1>Vulnerability Management API</h1>
<p>This document provides a detailed reference for the API endpoints used to manage vulnerability data within the HexTrackr system.</p>
<h2>API Conventions</h2>
<ul>
<li><strong>Authentication</strong>: No authentication is required for the current version.</li>
<li><strong>Response Format</strong>: All responses are in JSON.</li>
<li><strong>Error Handling</strong>: Errors are returned with a relevant HTTP status code and a JSON body containing an <code>error</code> message.</li>
</ul>
<hr>
<h2>Core Vulnerability Endpoints</h2>
<p>These endpoints provide the primary methods for retrieving and analyzing vulnerability data.</p>
<h3><code>GET /api/vulnerabilities</code></h3>
<p>Retrieves a paginated list of vulnerabilities, with support for searching and filtering. This is the main endpoint for populating the vulnerability grid.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Query Parameters</strong>:<ul>
<li><code>page</code> (optional, number): The page number for pagination (default: <code>1</code>).</li>
<li><code>limit</code> (optional, number): The number of results per page (default: <code>50</code>).</li>
<li><code>search</code> (optional, string): A search term to filter results by <code>hostname</code>, <code>cve</code>, or <code>plugin_name</code>.</li>
<li><code>severity</code> (optional, string): Filters results by a specific severity level (e.g., &quot;Critical&quot;, &quot;High&quot;).</li>
</ul>
</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;data&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;hostname&quot;: &quot;server-db-01&quot;,
      &quot;ip_address&quot;: &quot;192.168.1.10&quot;,
      &quot;cve&quot;: &quot;CVE-2023-12345&quot;,
      &quot;severity&quot;: &quot;Critical&quot;,
      &quot;vpr_score&quot;: 9.8,
      &quot;cvss_score&quot;: 9.5,
      &quot;first_seen&quot;: &quot;2023-01-15&quot;,
      &quot;last_seen&quot;: &quot;2023-08-20&quot;,
      &quot;plugin_name&quot;: &quot;Outdated Apache Version&quot;,
      &quot;state&quot;: &quot;open&quot;
    }
  ],
  &quot;pagination&quot;: {
    &quot;page&quot;: 1,
    &quot;limit&quot;: 50,
    &quot;total&quot;: 542,
    &quot;pages&quot;: 11
  }
}
</code></pre>
</li>
<li><strong>Error Response (500 Internal Server Error)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;Database error message&quot;
}
</code></pre>
</li>
</ul>
<h3><code>GET /api/vulnerabilities/stats</code></h3>
<p>Retrieves aggregated statistics about the vulnerabilities, grouped by severity. This is used to power the dashboard widgets.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Calculates the count, total VPR score, average VPR score, and date ranges for each severity level.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">[
  {
    &quot;severity&quot;: &quot;Critical&quot;,
    &quot;count&quot;: 50,
    &quot;total_vpr&quot;: 480.5,
    &quot;avg_vpr&quot;: 9.61,
    &quot;earliest&quot;: &quot;2023-01-10&quot;,
    &quot;latest&quot;: &quot;2023-08-19&quot;
  },
  {
    &quot;severity&quot;: &quot;High&quot;,
    &quot;count&quot;: 150,
    &quot;total_vpr&quot;: 1250.0,
    &quot;avg_vpr&quot;: 8.33,
    &quot;earliest&quot;: &quot;2023-02-01&quot;,
    &quot;latest&quot;: &quot;2023-08-20&quot;
  }
]
</code></pre>
</li>
</ul>
<h3><code>GET /api/vulnerabilities/trends</code></h3>
<p>Fetches historical data on new vulnerabilities over the last 14 days, formatted for trend chart visualization.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Groups new vulnerabilities by the date they were created and by severity.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">[
  {
    &quot;date&quot;: &quot;2023-08-20&quot;,
    &quot;Critical&quot;: 5,
    &quot;High&quot;: 12,
    &quot;Medium&quot;: 20,
    &quot;Low&quot;: 3
  },
  {
    &quot;date&quot;: &quot;2023-08-19&quot;,
    &quot;Critical&quot;: 2,
    &quot;High&quot;: 8,
    &quot;Medium&quot;: 15,
    &quot;Low&quot;: 1
  }
]
</code></pre>
</li>
</ul>
<hr>
<h2>Data Import and Management</h2>
<p>These endpoints handle the import of new vulnerability data and the clearing of existing data.</p>
<h3><code>POST /api/vulnerabilities/import</code></h3>
<p>Imports vulnerability data from a CSV file uploaded via a <code>multipart/form-data</code> request. This endpoint is intended for server-side file handling.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Body</strong>: A <code>multipart/form-data</code> payload containing:<ul>
<li><code>csvFile</code>: The vulnerability data file.</li>
<li><code>vendor</code> (optional): A string identifying the source of the data (e.g., &quot;Tenable&quot;).</li>
</ul>
</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;importId&quot;: 5,
  &quot;rowsProcessed&quot;: 12500,
  &quot;filename&quot;: &quot;vulnerability_scan_q3.csv&quot;,
  &quot;processingTime&quot;: 3450
}
</code></pre>
</li>
<li><strong>Error Response (400 Bad Request)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;No file uploaded&quot;
}
</code></pre>
</li>
</ul>
<h3><code>POST /api/import/vulnerabilities</code></h3>
<p>Imports vulnerability data from a JSON payload. This endpoint is designed for use with the frontend file upload component, which parses the CSV in the browser and sends the data as JSON.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Body</strong>:<pre><code class="language-json">{
  &quot;data&quot;: [
    { &quot;Host&quot;: &quot;web-server-01&quot;, &quot;CVE&quot;: &quot;CVE-2023-98765&quot;, &quot;Severity&quot;: &quot;High&quot;, ... },
    { &quot;Host&quot;: &quot;db-server-05&quot;, &quot;CVE&quot;: &quot;CVE-2023-11223&quot;, &quot;Severity&quot;: &quot;Critical&quot;, ... }
  ]
}
</code></pre>
</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;imported&quot;: 2,
  &quot;total&quot;: 2,
  &quot;importId&quot;: 6
}
</code></pre>
</li>
</ul>
<h3><code>DELETE /api/vulnerabilities/clear</code></h3>
<p>Deletes all vulnerability-related data from the database. This includes records in the <code>vulnerabilities</code>, <code>vulnerability_imports</code>, and <code>ticket_vulnerabilities</code> tables.</p>
<ul>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>Description</strong>: This is a destructive operation and should be used with caution.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;message&quot;: &quot;All vulnerability data cleared&quot;
}
</code></pre>
</li>
</ul>
<h3><code>GET /api/imports</code></h3>
<p>Retrieves a history of all vulnerability import operations.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Provides metadata for each import, including the filename, date, and number of rows processed.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">[
  {
    &quot;id&quot;: 6,
    &quot;filename&quot;: &quot;web-upload.csv&quot;,
    &quot;import_date&quot;: &quot;2023-08-21T10:00:00.000Z&quot;,
    &quot;row_count&quot;: 2,
    &quot;vendor&quot;: &quot;web-import&quot;,
    &quot;vulnerability_count&quot;: 2
  }
]
</code></pre>
</li>
</ul>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Footer -->
    <div id="footerContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Load shared header and footer -->
    <script src="../../scripts/shared/header-loader.js"></script>
    <script src="../../scripts/shared/footer-loader.js"></script>
</body>
</html>
