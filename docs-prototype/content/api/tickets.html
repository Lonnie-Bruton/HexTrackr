<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexTrackr - Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="../../styles/shared/base.css" rel="stylesheet">
    <link href="../../styles/shared/header.css" rel="stylesheet">
    <link href="../css/docs-tabler.css" rel="stylesheet">
</head>
<body>
    <div class="page">
        <!-- Shared Header -->
        <div id="headerContainer"></div>
        
        <div class="page-wrapper">
            <div class="page-body">
                <div class="container-xl">
                    <div class="row g-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h1>Ticket Management API</h1>
<p>This document provides a detailed reference for the API endpoints used to manage tickets within the HexTrackr system.</p>
<h2>API Conventions</h2>
<ul>
<li><strong>Authentication</strong>: No authentication is required for the current version.</li>
<li><strong>Response Format</strong>: All responses are in JSON.</li>
<li><strong>Error Handling</strong>: Errors are returned with a relevant HTTP status code and a JSON body containing an <code>error</code> message.</li>
</ul>
<hr>
<h2>Core Ticket Endpoints</h2>
<p>These endpoints provide the primary CRUD (Create, Read, Update, Delete) operations for tickets.</p>
<h3><code>GET /api/tickets</code></h3>
<p>Retrieves a list of all tickets from the database, ordered by their creation date in descending order.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: This endpoint is the main method for fetching the entire list of tickets to populate the main ticket grid. It includes a transformation to ensure that every ticket has a unique <code>id</code> field, falling back to <code>xt_number</code> if the primary <code>id</code> is null.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">[
  {
    &quot;id&quot;: &quot;ticket_1692557889&quot;,
    &quot;xt_number&quot;: &quot;XT001&quot;,
    &quot;date_submitted&quot;: &quot;2023-08-20&quot;,
    &quot;status&quot;: &quot;Open&quot;,
    &quot;location&quot;: &quot;Building A&quot;,
    &quot;supervisor&quot;: &quot;John Doe&quot;,
    &quot;tech&quot;: &quot;Jane Smith&quot;,
    &quot;devices&quot;: &quot;[]&quot;,
    &quot;notes&quot;: &quot;Initial ticket creation.&quot;
  }
]
</code></pre>
</li>
<li><strong>Error Response (500 Internal Server Error)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;Failed to fetch tickets&quot;
}
</code></pre>
</li>
</ul>
<h3><code>POST /api/tickets</code></h3>
<p>Creates a new ticket in the database.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Description</strong>: Saves a new ticket record. The request body must be a JSON object matching the ticket schema.</li>
<li><strong>Request Body</strong>:<pre><code class="language-json">{
  &quot;id&quot;: &quot;ticket_1692557890&quot;,
  &quot;xt_number&quot;: &quot;XT002&quot;,
  &quot;date_submitted&quot;: &quot;2023-08-21&quot;,
  &quot;status&quot;: &quot;In Progress&quot;,
  /* ... other ticket fields ... */
}
</code></pre>
</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;id&quot;: &quot;ticket_1692557890&quot;,
  &quot;message&quot;: &quot;Ticket saved successfully&quot;
}
</code></pre>
</li>
<li><strong>Error Response (500 Internal Server Error)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;Failed to save ticket&quot;
}
</code></pre>
</li>
</ul>
<h3><code>PUT /api/tickets/:id</code></h3>
<p>Updates an existing ticket identified by its unique ID.</p>
<ul>
<li><strong>Method</strong>: <code>PUT</code></li>
<li><strong>URL Parameters</strong>:<ul>
<li><code>id</code> (string, required): The unique identifier of the ticket to be updated.</li>
</ul>
</li>
<li><strong>Description</strong>: Modifies an existing ticket record. The request body should contain all fields for the ticket, as it performs a full update.</li>
<li><strong>Request Body</strong>: A JSON object with the updated ticket data.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;id&quot;: &quot;ticket_1692557890&quot;,
  &quot;message&quot;: &quot;Ticket updated successfully&quot;
}
</code></pre>
</li>
<li><strong>Error Response (500 Internal Server Error)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;Failed to update ticket&quot;
}
</code></pre>
</li>
</ul>
<h3><code>DELETE /api/tickets/:id</code></h3>
<p>Deletes a ticket from the database.</p>
<ul>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>URL Parameters</strong>:<ul>
<li><code>id</code> (string, required): The unique identifier of the ticket to be deleted.</li>
</ul>
</li>
<li><strong>Description</strong>: Permanently removes a ticket record from the <code>tickets</code> table.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;deleted&quot;: 1
}
</code></pre>
</li>
<li><strong>Error Response (500 Internal Server Error)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;Failed to delete ticket&quot;
}
</code></pre>
</li>
</ul>
<hr>
<h2>Data Migration and Import</h2>
<p>These endpoints are used for bulk data operations, such as migrating from a legacy system or importing from a CSV file.</p>
<h3><code>POST /api/tickets/migrate</code></h3>
<p>Migrates a batch of tickets into the database using an <code>INSERT OR REPLACE</code> strategy. This is useful for synchronizing data from another source.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Description</strong>: Processes an array of ticket objects. If a ticket with the same primary key (<code>id</code>) already exists, it will be replaced.</li>
<li><strong>Request Body</strong>:<pre><code class="language-json">{
  &quot;tickets&quot;: [
    { &quot;id&quot;: &quot;legacy_001&quot;, &quot;primary_number&quot;: &quot;INC123&quot;, /* ... */ },
    { &quot;id&quot;: &quot;legacy_002&quot;, &quot;primary_number&quot;: &quot;INC124&quot;, /* ... */ }
  ]
}
</code></pre>
</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;message&quot;: &quot;Migration completed: 2 tickets migrated, 0 errors&quot;
}
</code></pre>
</li>
</ul>
<h3><code>POST /api/import/tickets</code></h3>
<p>Imports ticket data from a JSON payload, which is typically generated by parsing a CSV file on the frontend.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Description</strong>: This endpoint is designed to receive structured JSON data from the client-side CSV import functionality. It uses an <code>INSERT OR REPLACE</code> strategy based on the ticket&#39;s <code>id</code>.</li>
<li><strong>Request Body</strong>:<pre><code class="language-json">{
  &quot;data&quot;: [
    {
      &quot;xt_number&quot;: &quot;XT101&quot;,
      &quot;Date Submitted&quot;: &quot;2023-08-20&quot;,
      &quot;Status&quot;: &quot;Open&quot;
    }
  ]
}
</code></pre>
</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;imported&quot;: 1,
  &quot;total&quot;: 1
}
</code></pre>
</li>
<li><strong>Error Response (400 Bad Request)</strong>:<pre><code class="language-json">{
  &quot;error&quot;: &quot;No data provided&quot;
}
</code></pre>
</li>
</ul>
<hr>
<h2>Auxiliary Endpoints</h2>
<p>These endpoints provide data related to tickets, such as sites and locations, which are used to populate dropdowns in the ticket creation/editing forms.</p>
<h3><code>GET /api/sites</code></h3>
<p>Retrieves a list of all available sites.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Fetches all records from the <code>sites</code> table, ordered by name.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">[
  { &quot;id&quot;: 1, &quot;name&quot;: &quot;Main Office&quot; },
  { &quot;id&quot;: 2, &quot;name&quot;: &quot;Data Center&quot; }
]
</code></pre>
</li>
</ul>
<h3><code>GET /api/locations</code></h3>
<p>Retrieves a list of all available locations.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Fetches all records from the <code>locations</code> table, ordered by name.</li>
<li><strong>Successful Response (200 OK)</strong>:<pre><code class="language-json">[
  { &quot;id&quot;: 1, &quot;name&quot;: &quot;Building A, Floor 1&quot; },
  { &quot;id&quot;: 2, &quot;name&quot;: &quot;Building B, Server Room&quot; }
]
</code></pre>
</li>
</ul>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Footer -->
    <div id="footerContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Load shared header and footer -->
    <script src="../../scripts/shared/header-loader.js"></script>
    <script src="../../scripts/shared/footer-loader.js"></script>
</body>
</html>
