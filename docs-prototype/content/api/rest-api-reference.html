<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexTrackr - Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="../../styles/shared/base.css" rel="stylesheet">
    <link href="../../styles/shared/header.css" rel="stylesheet">
    <link href="../css/docs-tabler.css" rel="stylesheet">
</head>
<body>
    <div class="page">
        <!-- Shared Header -->
        <div id="headerContainer"></div>
        
        <div class="page-wrapper">
            <div class="page-body">
                <div class="container-xl">
                    <div class="row g-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h1>REST API Reference</h1>
<p>This document provides a comprehensive reference for the HexTrackr REST API, which powers both the ticket and vulnerability management systems. All endpoints are prefixed with <code>/api</code>.</p>
<h2>API Conventions</h2>
<ul>
<li><strong>Base URL</strong>: All API endpoints are relative to the server&#39;s base URL (e.g., <code>http://localhost:8080</code>).</li>
<li><strong>Authentication</strong>: The current version of the API does not require authentication.</li>
<li><strong>Response Format</strong>: All responses are in JSON format.</li>
<li><strong>Error Handling</strong>: In case of an error, the API returns a standard JSON object with an <code>error</code> key containing a descriptive message and an appropriate HTTP status code (e.g., 400, 500).</li>
</ul>
<hr>
<h2>Vulnerability Management API</h2>
<p>These endpoints manage vulnerability data, including statistics, trends, and data import/export.</p>
<h3><code>GET /api/vulnerabilities/stats</code></h3>
<p>Retrieves aggregated statistics for vulnerabilities, grouped by severity.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Provides a count of vulnerabilities for each severity level (Critical, High, Medium, Low), along with the total and average VPR (Vulnerability Priority Rating) scores.</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">[
  {
    &quot;severity&quot;: &quot;Critical&quot;,
    &quot;count&quot;: 150,
    &quot;total_vpr&quot;: 1450.5,
    &quot;avg_vpr&quot;: 9.67,
    &quot;earliest&quot;: &quot;2023-01-10&quot;,
    &quot;latest&quot;: &quot;2023-08-20&quot;
  }
]
</code></pre>
</li>
</ul>
<h3><code>GET /api/vulnerabilities/trends</code></h3>
<p>Fetches historical vulnerability data for the last 14 days to generate trend charts.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Description</strong>: Returns a daily count of vulnerabilities by severity, formatted for consumption by charting libraries.</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">[
  {
    &quot;date&quot;: &quot;2023-08-20&quot;,
    &quot;Critical&quot;: 10,
    &quot;High&quot;: 25,
    &quot;Medium&quot;: 40,
    &quot;Low&quot;: 5
  }
]
</code></pre>
</li>
</ul>
<h3><code>GET /api/vulnerabilities</code></h3>
<p>Retrieves a paginated list of all vulnerabilities, with support for searching and filtering.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Query Parameters</strong>:<ul>
<li><code>page</code> (optional, number): The page number to retrieve (default: <code>1</code>).</li>
<li><code>limit</code> (optional, number): The number of records per page (default: <code>50</code>).</li>
<li><code>search</code> (optional, string): A search term to filter by hostname, CVE, or plugin name.</li>
<li><code>severity</code> (optional, string): A severity level to filter by.</li>
</ul>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;data&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;hostname&quot;: &quot;server-01&quot;,
      &quot;cve&quot;: &quot;CVE-2023-12345&quot;,
      &quot;vpr_score&quot;: 9.8,
      /* ... other fields ... */
    }
  ],
  &quot;pagination&quot;: {
    &quot;page&quot;: 1,
    &quot;limit&quot;: 50,
    &quot;total&quot;: 1234,
    &quot;pages&quot;: 25
  }
}
</code></pre>
</li>
</ul>
<h3><code>POST /api/vulnerabilities/import</code></h3>
<p>Imports vulnerability data from an uploaded CSV file. This endpoint is designed for server-side file uploads.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Type</strong>: <code>multipart/form-data</code></li>
<li><strong>Form Fields</strong>:<ul>
<li><code>csvFile</code>: The CSV file to be imported.</li>
<li><code>vendor</code> (optional, string): The source of the vulnerability data (e.g., &#39;Tenable&#39;, &#39;Qualys&#39;).</li>
</ul>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;importId&quot;: 123,
  &quot;rowsProcessed&quot;: 5000,
  &quot;filename&quot;: &quot;scan_results.csv&quot;,
  &quot;processingTime&quot;: 1500
}
</code></pre>
</li>
</ul>
<h3><code>DELETE /api/vulnerabilities/clear</code></h3>
<p>Deletes all vulnerability-related data from the database, including vulnerabilities, import history, and ticket-vulnerability links.</p>
<ul>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;message&quot;: &quot;All vulnerability data cleared&quot;
}
</code></pre>
</li>
</ul>
<hr>
<h2>Ticket Management API</h2>
<p>These endpoints provide full CRUD (Create, Read, Update, Delete) functionality for managing tickets.</p>
<h3><code>GET /api/tickets</code></h3>
<p>Retrieves a list of all tickets, ordered by creation date.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Response Body</strong>:<pre><code class="language-json">[
  {
    &quot;id&quot;: &quot;ticket_1692557889&quot;,
    &quot;xt_number&quot;: &quot;XT001&quot;,
    &quot;status&quot;: &quot;Open&quot;,
    /* ... other fields ... */
  }
]
</code></pre>
</li>
</ul>
<h3><code>POST /api/tickets</code></h3>
<p>Creates a new ticket.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Body</strong>: A JSON object representing the new ticket.</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;id&quot;: &quot;ticket_1692557889&quot;,
  &quot;message&quot;: &quot;Ticket saved successfully&quot;
}
</code></pre>
</li>
</ul>
<h3><code>PUT /api/tickets/:id</code></h3>
<p>Updates an existing ticket by its ID.</p>
<ul>
<li><strong>Method</strong>: <code>PUT</code></li>
<li><strong>URL Parameters</strong>:<ul>
<li><code>id</code>: The unique identifier of the ticket to update.</li>
</ul>
</li>
<li><strong>Request Body</strong>: A JSON object containing the updated ticket fields.</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;id&quot;: &quot;ticket_1692557889&quot;,
  &quot;message&quot;: &quot;Ticket updated successfully&quot;
}
</code></pre>
</li>
</ul>
<h3><code>DELETE /api/tickets/:id</code></h3>
<p>Deletes a ticket by its ID.</p>
<ul>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>URL Parameters</strong>:<ul>
<li><code>id</code>: The unique identifier of the ticket to delete.</li>
</ul>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;deleted&quot;: 1
}
</code></pre>
</li>
</ul>
<hr>
<h2>Data Import &amp; Export API</h2>
<p>These endpoints are used for importing data via JSON payloads (for frontend uploads) and for system-wide backup/restore operations.</p>
<h3><code>GET /api/imports</code></h3>
<p>Retrieves the history of all vulnerability data imports.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Response Body</strong>:<pre><code class="language-json">[
  {
    &quot;id&quot;: 1,
    &quot;filename&quot;: &quot;web-upload.csv&quot;,
    &quot;import_date&quot;: &quot;2023-08-20T18:00:00.000Z&quot;,
    &quot;row_count&quot;: 1500,
    &quot;vulnerability_count&quot;: 1500
  }
]
</code></pre>
</li>
</ul>
<h3><code>POST /api/import/tickets</code></h3>
<p>Imports ticket data from a JSON payload, typically from a CSV file parsed on the frontend.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Body</strong>:<pre><code class="language-json">{
  &quot;data&quot;: [
    { &quot;XT Number&quot;: &quot;XT101&quot;, &quot;Status&quot;: &quot;Open&quot;, /* ... */ }
  ]
}
</code></pre>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;imported&quot;: 1,
  &quot;total&quot;: 1
}
</code></pre>
</li>
</ul>
<h3><code>POST /api/import/vulnerabilities</code></h3>
<p>Imports vulnerability data from a JSON payload, typically from a CSV file parsed on the frontend.</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Body</strong>:<pre><code class="language-json">{
  &quot;data&quot;: [
    { &quot;Host&quot;: &quot;server-02&quot;, &quot;CVE&quot;: &quot;CVE-2023-54321&quot;, /* ... */ }
  ]
}
</code></pre>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;imported&quot;: 1,
  &quot;total&quot;: 1,
  &quot;importId&quot;: 124
}
</code></pre>
</li>
</ul>
<h3><code>GET /api/backup/stats</code></h3>
<p>Retrieves statistics about the database content for the settings modal.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;vulnerabilities&quot;: 5000,
  &quot;tickets&quot;: 150,
  &quot;total&quot;: 5150,
  &quot;dbSize&quot;: 10485760
}
</code></pre>
</li>
</ul>
<h3><code>GET /api/backup/:type</code></h3>
<p>Exports data (<code>vulnerabilities</code>, <code>tickets</code>, or <code>all</code>) as a JSON object for backup.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>URL Parameters</strong>:<ul>
<li><code>type</code>: The type of data to export (<code>vulnerabilities</code>, <code>tickets</code>, <code>all</code>).</li>
</ul>
</li>
<li><strong>Response Body</strong>: A JSON object containing the exported data.</li>
</ul>
<h3><code>POST /api/restore</code></h3>
<p>Restores data from an uploaded backup file (<code>.zip</code>).</p>
<ul>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Request Type</strong>: <code>multipart/form-data</code></li>
<li><strong>Form Fields</strong>:<ul>
<li><code>file</code>: The <code>.zip</code> backup file.</li>
<li><code>type</code>: The type of data to restore (<code>vulnerabilities</code>, <code>tickets</code>, <code>all</code>).</li>
<li><code>clearExisting</code> (optional, boolean): If <code>true</code>, clears existing data before restoring.</li>
</ul>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;message&quot;: &quot;Successfully restored 5150 records&quot;,
  &quot;count&quot;: 5150
}
</code></pre>
</li>
</ul>
<h3><code>DELETE /api/backup/clear/:type</code></h3>
<p>Clears data tables (<code>vulnerabilities</code>, <code>tickets</code>, or <code>all</code>).</p>
<ul>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>URL Parameters</strong>:<ul>
<li><code>type</code>: The type of data to clear.</li>
</ul>
</li>
<li><strong>Response Body</strong>:<pre><code class="language-json">{
  &quot;message&quot;: &quot;vulnerabilities cleared successfully&quot;
}
</code></pre>
</li>
</ul>
<hr>
<h2>Auxiliary API</h2>
<p>Endpoints for retrieving related data like sites and locations.</p>
<h3><code>GET /api/sites</code></h3>
<p>Retrieves a list of all configured sites.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Response Body</strong>:<pre><code class="language-json">[
  { &quot;id&quot;: 1, &quot;name&quot;: &quot;Main Office&quot; },
  { &quot;id&quot;: 2, &quot;name&quot;: &quot;Data Center&quot; }
]
</code></pre>
</li>
</ul>
<h3><code>GET /api/locations</code></h3>
<p>Retrieves a list of all configured locations.</p>
<ul>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Response Body</strong>:<pre><code class="language-json">[
  { &quot;id&quot;: 1, &quot;name&quot;: &quot;Building A&quot; },
  { &quot;id&quot;: 2, &quot;name&quot;: &quot;Building B&quot; }
]
</code></pre>
</li>
</ul>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Footer -->
    <div id="footerContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Load shared header and footer -->
    <script src="../../scripts/shared/header-loader.js"></script>
    <script src="../../scripts/shared/footer-loader.js"></script>
</body>
</html>
