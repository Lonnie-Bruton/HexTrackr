<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexTrackr - Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="/styles/shared/base.css" rel="stylesheet">
    <link href="/styles/shared/header.css" rel="stylesheet">
    <link href="/docs-prototype/css/docs-tabler.css" rel="stylesheet">
</head>
<body>
    <div class="page">
        <!-- Shared Header -->
        <div id="headerContainer"></div>
        
        <div class="page-wrapper">
            <div class="page-body">
                <div class="container-xl">
                    <div class="row g-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h1>Vulnerabilities API</h1>
<p>Endpoints for listing, statistics, trends, CSV upload, JSON import, and clearing vulnerability data.</p>
<h2>Endpoints</h2>
<h3>GET /api/vulnerabilities</h3>
<ul>
<li>Description: List vulnerabilities with pagination, optional search and severity filter.</li>
<li>Query params:<ul>
<li>page: number (default 1)</li>
<li>limit: number (default 50)</li>
<li>search: string (matches hostname, cve, plugin_name)</li>
<li>severity: string (Critical|High|Medium|Low)</li>
</ul>
</li>
<li>Response: 200 OK<pre><code class="language-json">{
  &quot;data&quot;: [
    {
      &quot;id&quot;: 10,
      &quot;import_id&quot;: 3,
      &quot;hostname&quot;: &quot;host-1&quot;,
      &quot;ip_address&quot;: &quot;10.0.0.1&quot;,
      &quot;cve&quot;: &quot;CVE-2024-0001&quot;,
      &quot;severity&quot;: &quot;High&quot;,
      &quot;vpr_score&quot;: 8.6,
      &quot;cvss_score&quot;: 7.5,
      &quot;first_seen&quot;: &quot;2025-08-10&quot;,
      &quot;last_seen&quot;: &quot;2025-08-20&quot;,
      &quot;plugin_id&quot;: &quot;100001&quot;,
      &quot;plugin_name&quot;: &quot;Vulnerability name&quot;,
      &quot;description&quot;: &quot;...&quot;,
      &quot;solution&quot;: &quot;...&quot;,
      &quot;vendor&quot;: &quot;Cisco&quot;,
      &quot;vulnerability_date&quot;: &quot;2025-08-05&quot;,
      &quot;state&quot;: &quot;open&quot;,
      &quot;import_date&quot;: &quot;2025-08-20&quot;,
      &quot;created_at&quot;: &quot;2025-08-20T12:00:00.000Z&quot;
    }
  ],
  &quot;pagination&quot;: { &quot;page&quot;: 1, &quot;limit&quot;: 50, &quot;total&quot;: 1234, &quot;pages&quot;: 25 }
}
</code></pre>
</li>
</ul>
<h3>GET /api/vulnerabilities/stats</h3>
<ul>
<li>Description: Aggregated statistics by severity with VPR totals/averages and date range.</li>
<li>Response: 200 OK Array<pre><code class="language-json">[
  { &quot;severity&quot;: &quot;Critical&quot;, &quot;count&quot;: 12, &quot;total_vpr&quot;: 100.1, &quot;avg_vpr&quot;: 8.34, &quot;earliest&quot;: &quot;2025-08-01&quot;, &quot;latest&quot;: &quot;2025-08-20&quot; }
]
</code></pre>
</li>
</ul>
<h3>GET /api/vulnerabilities/trends</h3>
<ul>
<li>Description: Historical counts by day and severity for the last 14 days.</li>
<li>Response: 200 OK Array (one object per date)<pre><code class="language-json">[ { &quot;date&quot;: &quot;2025-08-20&quot;, &quot;Critical&quot;: 1, &quot;High&quot;: 5, &quot;Medium&quot;: 3, &quot;Low&quot;: 0 } ]
</code></pre>
</li>
</ul>
<h3>POST /api/vulnerabilities/import</h3>
<ul>
<li>Description: Upload a CSV file and import rows. Creates a record in vulnerability_imports and inserts normalized rows.</li>
<li>Body: multipart/form-data<ul>
<li>csvFile: file (required)</li>
<li>vendor: string (optional)</li>
</ul>
</li>
<li>Response: 200 OK<pre><code class="language-json">{ &quot;success&quot;: true, &quot;importId&quot;: 7, &quot;rowsProcessed&quot;: 250, &quot;filename&quot;: &quot;export.csv&quot;, &quot;processingTime&quot;: 5234 }
</code></pre>
</li>
</ul>
<h3>POST /api/import/vulnerabilities</h3>
<ul>
<li>Description: Import vulnerabilities from a JSON array (frontend CSV to JSON). Also records an import in vulnerability_imports.</li>
<li>Body: application/json<pre><code class="language-json">{ &quot;data&quot;: [ { &quot;hostname&quot;: &quot;host-1&quot;, &quot;cve&quot;: &quot;CVE-2024-0001&quot;, &quot;severity&quot;: &quot;High&quot; } ] }
</code></pre>
</li>
<li>Response: 200 OK<pre><code class="language-json">{ &quot;success&quot;: true, &quot;imported&quot;: 1, &quot;total&quot;: 1, &quot;importId&quot;: 8 }
</code></pre>
</li>
</ul>
<h3>GET /api/imports</h3>
<ul>
<li>Description: List import history with counts of vulnerabilities per import.</li>
<li>Response: 200 OK Array of import records.</li>
</ul>
<h3>DELETE /api/vulnerabilities/clear</h3>
<ul>
<li>Description: Clears ticket_vulnerabilities, vulnerabilities, and vulnerability_imports.</li>
<li>Response: 200 OK<pre><code class="language-json">{ &quot;success&quot;: true, &quot;message&quot;: &quot;All vulnerability data cleared&quot; }
</code></pre>
</li>
</ul>
<h2>Error responses</h2>
<ul>
<li>400 Bad Request: Missing file or invalid body.</li>
<li>500 Internal Server Error: Database/CSV parsing errors.</li>
</ul>
<h2>Notes</h2>
<ul>
<li>Columns added at runtime via ALTER TABLE: vendor, vulnerability_date, state, import_date.</li>
<li>CSV mappings support multiple vendor formats (Cisco/Tenable-like headers).</li>
</ul>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Footer -->
    <div id="footerContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Load shared header and footer -->
    <script src="/scripts/shared/header-loader.js"></script>
    <script src="/scripts/shared/footer-loader.js"></script>
    <script src="/docs-prototype/js/docs-tabler.js"></script>
</body>
</html>
