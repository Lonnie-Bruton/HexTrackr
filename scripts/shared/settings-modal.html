<!-- HexTrackr Shared Settings Modal -->
<div class="modal modal-blur fade" id="settingsModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">HexTrackr Settings</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-3">
            <div class="nav nav-pills nav-fill flex-column" role="tablist">
              <a class="nav-link active" id="api-config-tab" data-bs-toggle="pill" href="#api-config" role="tab" aria-controls="api-config" aria-selected="true">API Configuration</a>
              <a class="nav-link" id="data-management-tab" data-bs-toggle="pill" href="#data-management" role="tab" aria-controls="data-management" aria-selected="false">Data Management</a>
              <a class="nav-link" id="ticket-systems-tab" data-bs-toggle="pill" href="#ticket-systems" role="tab" aria-controls="ticket-systems" aria-selected="false">Ticket Systems</a>
              <a class="nav-link" id="system-config-tab" data-bs-toggle="pill" href="#system-config" role="tab" aria-controls="system-config" aria-selected="false">System Configuration</a>
            </div>
          </div>
          <div class="col-9">
            <div class="tab-content">
              <!-- API Configuration Tab -->
              <div class="tab-pane fade show active" id="api-config" role="tabpanel" aria-labelledby="api-config-tab">
                <h4>API Configuration</h4>
                <div class="row">
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">API Endpoint</label>
                      <input type="text" class="form-control" id="apiEndpoint" placeholder="http://localhost:8080/api">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">Refresh Interval (seconds)</label>
                      <input type="number" class="form-control" id="refreshInterval" placeholder="30">
                    </div>
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">API Key (Optional)</label>
                  <input type="password" class="form-control" id="apiKey" placeholder="Enter API key if required">
                </div>
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" id="enableApiAuth">
                  <label class="form-check-label" for="enableApiAuth">Enable API Authentication</label>
                </div>
              </div>

              <!-- Data Management Tab -->
              <div class="tab-pane fade" id="data-management" role="tabpanel" aria-labelledby="data-management-tab">
                <h4>Data Management</h4>
                
                <!-- Import Section -->
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Import Data</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-lg-6">
                        <h6>Import Tickets</h6>
                        <div class="mb-3">
                          <label for="ticketFileUpload" class="form-label">Upload Tickets CSV</label>
                          <input class="form-control" type="file" id="ticketFileUpload" accept=".csv">
                        </div>
                        <button type="button" class="btn btn-primary" id="importTicketsBtn">Import Tickets</button>
                      </div>
                      <div class="col-lg-6">
                        <h6>Import Vulnerabilities</h6>
                        <div class="mb-3">
                          <label for="vulnFileUpload" class="form-label">Upload Vulnerabilities CSV</label>
                          <input class="form-control" type="file" id="vulnFileUpload" accept=".csv">
                        </div>
                        <button type="button" class="btn btn-primary" id="importVulnBtn">Import Vulnerabilities</button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Export Section -->
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Export Data</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-lg-6">
                        <h6>Export Tickets</h6>
                        <div class="btn-group d-block mb-2">
                          <button type="button" class="btn btn-outline-primary btn-sm" id="exportTicketsCsv">CSV</button>
                          <button type="button" class="btn btn-outline-primary btn-sm" id="exportTicketsJson">JSON</button>
                          <button type="button" class="btn btn-outline-primary btn-sm" id="exportTicketsPdf">PDF</button>
                        </div>
                      </div>
                      <div class="col-lg-6">
                        <h6>Export Vulnerabilities</h6>
                        <div class="btn-group d-block mb-2">
                          <button type="button" class="btn btn-outline-primary btn-sm" id="exportVulnCsv">CSV</button>
                          <button type="button" class="btn btn-outline-primary btn-sm" id="exportVulnJson">JSON</button>
                          <button type="button" class="btn btn-outline-primary btn-sm" id="exportVulnPdf">PDF</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Backup Section -->
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title">Database Management</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-lg-6">
                        <button type="button" class="btn btn-success" id="backupDbBtn">Create Backup</button>
                        <p class="text-muted small mt-1">Create a backup of the current database</p>
                      </div>
                      <div class="col-lg-6">
                        <button type="button" class="btn btn-danger" id="clearDataBtn">Clear All Data</button>
                        <p class="text-muted small mt-1">⚠️ This will permanently delete all data</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Ticket Systems Tab -->
              <div class="tab-pane fade" id="ticket-systems" role="tabpanel" aria-labelledby="ticket-systems-tab">
                <h4>Ticket Systems Integration</h4>
                
                <!-- ServiceNow Integration -->
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">ServiceNow Integration</h5>
                  </div>
                  <div class="card-body">
                    <div class="form-check form-switch mb-3">
                      <input class="form-check-input" type="checkbox" id="enableServiceNow">
                      <label class="form-check-label" for="enableServiceNow">Enable ServiceNow Integration</label>
                    </div>
                    
                    <div id="serviceNowConfig" style="display: none;">
                      <div class="mb-3">
                        <label class="form-label">ServiceNow Instance URL</label>
                        <input type="url" class="form-control" id="serviceNowUrl" placeholder="https://yourcompany.service-now.com">
                        <div class="form-text">Enter your ServiceNow instance URL (without trailing slash)</div>
                      </div>
                      
                      <div class="mb-3">
                        <label class="form-label">URL Pattern Preview</label>
                        <div class="form-control-plaintext" id="serviceNowPreview">ServiceNow integration is disabled</div>
                      </div>
                      
                      <div class="row">
                        <div class="col-lg-6">
                          <button type="button" class="btn btn-outline-primary" id="testServiceNowBtn">Test Link</button>
                        </div>
                        <div class="col-lg-6">
                          <button type="button" class="btn btn-primary" id="saveServiceNowBtn">Save Configuration</button>
                        </div>
                      </div>
                      
                      <div class="mt-3">
                        <strong>Integration Status:</strong> <span id="serviceNowStatus">Disabled</span>
                      </div>
                      
                      <div class="mt-3">
                        <h6>How it works:</h6>
                        <ul class="text-muted small">
                          <li>INC# and CHG# numbers in your tickets become clickable links</li>
                          <li>Links open directly to the specific incident/change in ServiceNow</li>
                          <li>Works with standard ServiceNow URL patterns</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Future Integrations -->
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title">Future Integrations</h5>
                  </div>
                  <div class="card-body">
                    <div class="text-muted">
                      <p>Additional ticket system integrations coming soon:</p>
                      <ul>
                        <li>Jira Integration</li>
                        <li>Remedy Integration</li>
                        <li>Custom API Endpoints</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- System Configuration Tab -->
              <div class="tab-pane fade" id="system-config" role="tabpanel" aria-labelledby="system-config-tab">
                <h4>System Configuration</h4>
                <div class="row">
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">Page Size</label>
                      <select class="form-select" id="pageSize">
                        <option value="10">10 items per page</option>
                        <option value="25" selected>25 items per page</option>
                        <option value="50">50 items per page</option>
                        <option value="100">100 items per page</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Date Format</label>
                      <select class="form-select" id="dateFormat">
                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                        <option value="YYYY-MM-DD" selected>YYYY-MM-DD</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-check form-switch mb-3">
                      <input class="form-check-input" type="checkbox" id="enableNotifications">
                      <label class="form-check-label" for="enableNotifications">Enable Notifications</label>
                    </div>
                    <div class="form-check form-switch mb-3">
                      <input class="form-check-input" type="checkbox" id="enableAutoRefresh">
                      <label class="form-check-label" for="enableAutoRefresh">Auto-refresh Data</label>
                    </div>
                    <div class="form-check form-switch mb-3">
                      <input class="form-check-input" type="checkbox" id="enableDarkMode">
                      <label class="form-check-label" for="enableDarkMode">Dark Mode</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="saveSettings">Save All Settings</button>
      </div>
    </div>
  </div>
</div>
